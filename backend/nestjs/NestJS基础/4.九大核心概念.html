<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kkzzyytçš„ä¸ªäººè®°å½• | kkzzyytçš„ä¸ªäººè®°å½•</title>
    <meta name="description" content="Talk is cheap, show me your code.">
    <link rel="preload stylesheet" href="/blog/assets/style.74d9b1b1.css" as="style">
    
    <script type="module" src="/blog/assets/app.a086eb3e.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/blog/assets/chunks/framework.01edc906.js">
    <link rel="modulepreload" href="/blog/assets/chunks/theme.81c0dc4b.js">
    <link rel="modulepreload" href="/blog/assets/backend_nestjs_NestJSåŸºç¡€_4.ä¹å¤§æ ¸å¿ƒæ¦‚å¿µ.md.b033e4c6.lean.js">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6284acba><!--[--><!--]--><!--[--><span tabindex="-1" data-v-82f3cb66></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-82f3cb66> Skip to content </a><!--]--><!----><header class="VPNav" data-v-6284acba data-v-67c8a58c><div class="VPNavBar has-sidebar" data-v-67c8a58c data-v-d094a9cd><div class="container" data-v-d094a9cd><div class="title" data-v-d094a9cd><div class="VPNavBarTitle has-sidebar" data-v-d094a9cd data-v-9f17e1eb><a class="title" href="/blog/" data-v-9f17e1eb><!--[--><!--]--><!--[--><img class="VPImage logo" src="/blog/img/logo.png" alt data-v-881f6afe><!--]--><!--[-->ğŸ“ code<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-d094a9cd><div class="curtain" data-v-d094a9cd></div><div class="content-body" data-v-d094a9cd><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-d094a9cd><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-d094a9cd data-v-70755f9a><span id="main-nav-aria-label" class="visually-hidden" data-v-70755f9a>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/index.html" tabindex="0" data-v-70755f9a data-v-3b3cd99c><!--[--><span data-v-3b3cd99c>é¦–é¡µ</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-70755f9a data-v-58b1f253><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-58b1f253><span class="text" data-v-58b1f253><!----><span data-v-58b1f253>å‰ç«¯å°é£Ÿå ‚</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-58b1f253><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-58b1f253><div class="VPMenu" data-v-58b1f253 data-v-d0aac7fb><div class="items" data-v-d0aac7fb><!--[--><!--[--><div class="VPMenuGroup" data-v-d0aac7fb data-v-7f9c2b2d><p class="title" data-v-7f9c2b2d>åŸºæœ¬åŠŸ</p><!--[--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/frontend/html/" data-v-b4a6105c><!--[-->Html<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/frontend/css/" data-v-b4a6105c><!--[-->CSS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/frontend/javascript/" data-v-b4a6105c><!--[-->JavaScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/frontend/typescript/" data-v-b4a6105c><!--[-->TypeScript<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-d0aac7fb data-v-7f9c2b2d><p class="title" data-v-7f9c2b2d>æ¡†æ¶</p><!--[--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/frontend/react/" data-v-b4a6105c><!--[-->React<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/frontend/vue/" data-v-b4a6105c><!--[-->Vue<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-d0aac7fb data-v-7f9c2b2d><p class="title" data-v-7f9c2b2d>ä¸°å¯Œèµ„æº</p><!--[--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/frontend/ui/" data-v-b4a6105c><!--[-->ç»„ä»¶åº“<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-70755f9a data-v-58b1f253><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-58b1f253><span class="text" data-v-58b1f253><!----><span data-v-58b1f253>åç«¯è‡ªä¹ å®¤</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-58b1f253><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-58b1f253><div class="VPMenu" data-v-58b1f253 data-v-d0aac7fb><div class="items" data-v-d0aac7fb><!--[--><!--[--><div class="VPMenuGroup" data-v-d0aac7fb data-v-7f9c2b2d><p class="title" data-v-7f9c2b2d>æ¡†æ¶</p><!--[--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/backend/nestjs/" data-v-b4a6105c><!--[-->NestJS<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-d0aac7fb data-v-7f9c2b2d><p class="title" data-v-7f9c2b2d>æœåŠ¡</p><!--[--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/backend/nginx/" data-v-b4a6105c><!--[-->Nginx<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7f9c2b2d data-v-b4a6105c><a class="VPLink link" href="/blog/backend/gitLearn/" data-v-b4a6105c><!--[-->Git<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-d094a9cd data-v-8ef61f71><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-8ef61f71 data-v-8d1c8693 data-v-9c3a0906><span class="check" data-v-9c3a0906><span class="icon" data-v-9c3a0906><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-8d1c8693><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-8d1c8693><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-d094a9cd data-v-ff9a62a8 data-v-5ad38951><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zhu325" aria-label="github" target="_blank" rel="noopener" data-v-5ad38951 data-v-e085e322><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-d094a9cd data-v-42e60ece data-v-58b1f253><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-58b1f253><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-58b1f253><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-58b1f253><div class="VPMenu" data-v-58b1f253 data-v-d0aac7fb><!----><!--[--><!--[--><!----><div class="group" data-v-42e60ece><div class="item appearance" data-v-42e60ece><p class="label" data-v-42e60ece>Appearance</p><div class="appearance-action" data-v-42e60ece><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-42e60ece data-v-8d1c8693 data-v-9c3a0906><span class="check" data-v-9c3a0906><span class="icon" data-v-9c3a0906><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-8d1c8693><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-8d1c8693><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-42e60ece><div class="item social-links" data-v-42e60ece><div class="VPSocialLinks social-links-list" data-v-42e60ece data-v-5ad38951><!--[--><a class="VPSocialLink no-icon" href="https://github.com/zhu325" aria-label="github" target="_blank" rel="noopener" data-v-5ad38951 data-v-e085e322><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-d094a9cd data-v-b9d21bbb><span class="container" data-v-b9d21bbb><span class="top" data-v-b9d21bbb></span><span class="middle" data-v-b9d21bbb></span><span class="bottom" data-v-b9d21bbb></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-6284acba data-v-460e914a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-460e914a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-460e914a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-460e914a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-460e914a data-v-96dd8966><button data-v-96dd8966>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-6284acba data-v-a7ebba09><div class="curtain" data-v-a7ebba09></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a7ebba09><span class="visually-hidden" id="sidebar-aria-label" data-v-a7ebba09> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-a7ebba09><section class="VPSidebarItem level-0 collapsible has-active" data-v-a7ebba09 data-v-62317b56><div class="item" role="button" tabindex="0" data-v-62317b56><div class="indicator" data-v-62317b56></div><h2 class="text" data-v-62317b56>NestJSåŸºç¡€</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-62317b56><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-62317b56><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-62317b56><!--[--><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E5%9F%BA%E7%A1%80/1.Nestjs%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E3%80%90%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E3%80%91.html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>1.Nestjsé¡¹ç›®å¼€å‘ã€ç¼–ç¨‹æ€æƒ³ã€‘</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E5%9F%BA%E7%A1%80/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%B0%8F%E7%BB%93.html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>2.æ ¸å¿ƒæ¦‚å¿µå°ç»“</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E5%9F%BA%E7%A1%80/3.ExecutionContext.html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>3.ExecutionContext</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E5%9F%BA%E7%A1%80/4.%E4%B9%9D%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5.html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>4.ä¹å¤§æ ¸å¿ƒæ¦‚å¿µ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a7ebba09><section class="VPSidebarItem level-0 collapsible" data-v-a7ebba09 data-v-62317b56><div class="item" role="button" tabindex="0" data-v-62317b56><div class="indicator" data-v-62317b56></div><h2 class="text" data-v-62317b56>NestJSè¿›é˜¶</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-62317b56><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-62317b56><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-62317b56><!--[--><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/1.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5.html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>1.ä¾èµ–æ³¨å…¥</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/2.%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>2.ç”Ÿå‘½å‘¨æœŸ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/3.%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2(%E2%9A%91).html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>3.æ‰“åŒ…éƒ¨ç½²(âš‘)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/4.%E6%95%B4%E5%90%88prisma(todo).html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>4.æ•´åˆprisma(todo)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/5.%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE(todo).html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>5.é«˜çº§é…ç½®(todo)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/6.%E7%BC%93%E5%AD%98(todo).html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>6.ç¼“å­˜(todo)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a7ebba09><section class="VPSidebarItem level-0 collapsible" data-v-a7ebba09 data-v-62317b56><div class="item" role="button" tabindex="0" data-v-62317b56><div class="indicator" data-v-62317b56></div><h2 class="text" data-v-62317b56>å®‰å…¨è®¤è¯</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-62317b56><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-62317b56><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-62317b56><!--[--><div class="VPSidebarItem level-1 is-link" data-v-62317b56 data-v-62317b56><div class="item" data-v-62317b56><div class="indicator" data-v-62317b56></div><a class="VPLink link link" href="/blog/backend/nestjs/%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/1.%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81(JWT).html" data-v-62317b56><!--[--><p class="text" data-v-62317b56>1.ç™»å½•è®¤è¯(JWT)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-6284acba data-v-078871f0><div class="VPDoc has-sidebar has-aside" data-v-078871f0 data-v-2cdec040><!--[--><!--]--><div class="container" data-v-2cdec040><div class="aside" data-v-2cdec040><div class="aside-curtain" data-v-2cdec040></div><div class="aside-container" data-v-2cdec040><div class="aside-content" data-v-2cdec040><div class="VPDocAside" data-v-2cdec040 data-v-5f87bc6e><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-5f87bc6e data-v-3d706213><div class="content" data-v-3d706213><div class="outline-marker" data-v-3d706213></div><div class="outline-title" role="heading" data-v-3d706213>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-3d706213><span class="visually-hidden" id="doc-outline-aria-label" data-v-3d706213> Table of Contents for current page </span><ul class="root" data-v-3d706213 data-v-717ff320><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-5f87bc6e></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-2cdec040><div class="content-container" data-v-2cdec040><!--[--><!--]--><!----><main class="main" data-v-2cdec040><div style="position:relative;" class="vp-doc _blog_backend_nestjs_NestJS%E5%9F%BA%E7%A1%80_4_%E4%B9%9D%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" data-v-2cdec040><div><p>Nestjsçš„æ ¸å¿ƒæ¦‚å¿µå¾ˆå¤šï¼Œå¦‚æœæ˜¯å­¦è¿‡javaçš„å…„å¼Ÿä¼šæ¯”è¾ƒç†Ÿæ‚‰ï¼Œåˆšå¼€å§‹æ¥è§¦è¿˜æ˜¯ä¼šæœ‰ä¸€äº›é™Œç”Ÿï¼Œå¸Œæœ›é€šè¿‡æœ¬æ–‡è½»è½»æ¾æ¾ç†è§£Nestjsçš„è¿™äº›æ ¸å¿ƒæ¦‚å¿µï¼Œå…ˆæ¥æ•´ä½“çœ‹ä¸€ä¸‹æœ‰å“ªäº›ï¼š</p><ul><li>Controllers</li><li>Providers</li><li>Modules</li><li>Middleware</li><li>Exception filters</li><li>Pipes</li><li>Guards</li><li>Interceptors</li><li>Custom decorators</li></ul><p>æ€»å…±9ä¸ªä¸œè¥¿ï¼Œè¦æƒ³å…¨éƒ¨æŒæ¡è¿˜æ˜¯éœ€è¦ä¸€å®šæ—¶é—´çš„ï¼Œæœ¬æ–‡æ˜¯ä¸ªäººå­¦ä¹ ç¬”è®°ï¼Œä¹Ÿç®—æ˜¯æŠ›ç –å¼•ç‰ï¼Œè¯´çš„ä¸åˆ°ä½çš„åœ°æ–¹ï¼Œå¤§ä½¬å‹¿å–·ã€‚</p><p>ç†Ÿæ‚‰javaçš„åŒå­¦ï¼Œå¯¹springå®¹å™¨ä¸€å®šå¾ˆç†Ÿæ‚‰ï¼Œå®ƒå¯ä»¥ç”¨æ¥ç®¡ç†å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ä¸ç”¨è‡ªå·±newå‡ºæ¥ï¼Œåªéœ€è¦åŠ ä¸Šç±»ä¼¼@Controllerçš„æ³¨è§£å°±ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªå¯¹è±¡ï¼Œå…¨å…¨ç”±å®¹å™¨è´Ÿè´£ç®¡ç†ï¼Œè¿™å…¶å®æ˜¯ä¸€ç§å•ä¾‹æ¨¡å¼çš„æ€æƒ³ã€‚</p><h2 id="ä¸€ã€controllers" tabindex="-1">ä¸€ã€Controllers <a class="header-anchor" href="#ä¸€ã€controllers" aria-label="Permalink to &quot;ä¸€ã€Controllers&quot;">â€‹</a></h2><p>Controllers are responsible for handling incoming <strong>requests</strong> and returning <strong>responses</strong> to the client.</p><p>æ§åˆ¶å™¨æ˜¯ç”¨æ¥åšè·¯ç”±å¯¼èˆªçš„ï¼Œæ§åˆ¶ç€ä½ çš„è¯·æ±‚è·¯å¾„å»å¾€ä½•æ–¹ï¼Œæ¯”å¦‚<a href="http://xxx.com/user%EF%BC%8C%E5%8C%B9%E9%85%8D%E7%9A%84%E8%B7%AF%E5%BE%84%E6%98%AF/user%E3%80%82" target="_blank" rel="noreferrer">http://xxx.com/userï¼ŒåŒ¹é…çš„è·¯å¾„æ˜¯/userã€‚</a></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/18ce1d3e647f41cda8e7402d0e730a93~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><ul><li>é€šè¿‡@Controller(...path...)æ¥æ„é€ ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œ</li><li>åœ¨Moduleçš„ä¸­çš„@Moduleè£…é¥°å™¨å†…æ”¾å…¥æ§åˆ¶å™¨ï¼Œ@Module({controllers:[xxxController]})åªæœ‰è¿™æ ·ï¼ŒNestçš„Iocå®¹å™¨æ‰ä¼šäº§ç”Ÿå‡ºè¯¥æ§åˆ¶å™¨çš„å®ä¾‹ï¼Œæ‰èƒ½ä¸ºä½ çš„applicationæ‰€ç”¨</li><li>å¸¸ç”¨çš„æ–¹æ³•è£…é¥°å™¨æœ‰@Get()ã€@Post()ã€@Patch()ã€@Delete()ã€ç­‰ç­‰</li><li>å¸¸ç”¨çš„æ–¹æ³•å‚æ•°è£…é¥°å™¨æœ‰@Body()ã€@Query()ã€@Param()ã€@Request()/@Req()ã€@Response()/@Res()</li><li>@HttpCode()ã€@Header()ã€@Redirect()ç­‰è¿™å‡ ä¸ªå¯èƒ½ç”¨çš„æ¯”è¾ƒå°‘ï¼Œåæ­£æˆ‘ç›®å‰åŸºæœ¬ä¸ç”¨</li></ul><h2 id="äºŒã€providers" tabindex="-1">äºŒã€Providers <a class="header-anchor" href="#äºŒã€providers" aria-label="Permalink to &quot;äºŒã€Providers&quot;">â€‹</a></h2><p>Providers are a fundamental concept in Nest. Many of the basic Nest classes may be treated as a provider â€“ services, repositories, factories, helpers, and so on. The main idea of a provider is that it can be <strong>injected</strong> as a dependency; this means objects can create various relationships with each other, and the function of &quot;wiring up&quot; instances of objects can largely be delegated to the Nest runtime system.</p><p>Providersæ˜¯ä¸€ä¸ªå¾ˆåŸºæœ¬çš„æ¦‚å¿µï¼Œå¾ˆå¤šNestä¸­å®šä¹‰çš„ç±»å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªProviderï¼Œæˆ‘ç†è§£çš„Providerå…¶å®å°±æ˜¯å¯ä»¥ä¸ºå„ä¸ªæ¨¡å—æä¾›æœåŠ¡çš„ï¼Œè¿™ä¸ªæœåŠ¡èŒƒå›´å¾ˆå¹¿ï¼Œä¾‹å¦‚å¯ä»¥æ˜¯ä¸€ä¸ªæ“ä½œæ•°æ®åº“æŸå¼ è¡¨çš„Serviceï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œè¿™äº›æœåŠ¡å¯ä»¥è¢«æ³¨å…¥ä¾èµ–ä½“ç³»ï¼Œæ³¨å…¥ç›¸å…³ä¾èµ–åï¼Œå¯ä»¥åœ¨æ–¹ä½¿ç”¨ã€‚è¿™ä¸ªå’Œjavaä¸­çš„@Autowired()è‡ªåŠ¨è£…é…æ¯”è¾ƒç±»ä¼¼ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šä¸åŒï¼Œ</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/54e7c70ff49b4f6ab8d4f9e45da03ef6~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>æˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„è¿˜æ˜¯ç±»ï¼Œä¸‹é¢ä¸»è¦ä»¥ç±»æ¥ä¸¾ä¾‹</p><h3 id="_1-æœ€å¸¸ç”¨çš„æœåŠ¡å°±æ˜¯ç±»" tabindex="-1">1. æœ€å¸¸ç”¨çš„æœåŠ¡å°±æ˜¯ç±»ï¼ <a class="header-anchor" href="#_1-æœ€å¸¸ç”¨çš„æœåŠ¡å°±æ˜¯ç±»" aria-label="Permalink to &quot;1. æœ€å¸¸ç”¨çš„æœåŠ¡å°±æ˜¯ç±»ï¼&quot;">â€‹</a></h3><ul><li><strong>æœåŠ¡ç±»ä½¿ç”¨@Injectable()è£…é¥°å™¨è£…é¥°ï¼Œè¡¨æ˜è¯¥ç±»å¯ä»¥ç”±Nestçš„IoCå®¹å™¨ç®¡ç†</strong></li><li><strong>æœåŠ¡éœ€è¦åœ¨å¯¹åº”çš„moduleä¸­è¿›è¡Œæ³¨å†Œï¼Œå¦‚æœä¸æ³¨å†ŒIoCå®¹å™¨æ˜¯ä¸ä¼šå¸®ä½ åˆ›å»ºå¯¹è±¡çš„ï¼Œè€Œä¸”è¿˜ä¼šæŠ¥é”™</strong></li><li><strong>åœ¨å…¶å®ƒç±»ä¸­ä½¿ç”¨æ—¶ï¼ˆå¦‚Controlleræ§åˆ¶å™¨ä¸­ï¼‰ï¼Œåœ¨è¯¥ç±»çš„æ„é€ å‡½æ•°çš„å‚æ•°ä¸­è¿›è¡Œæ³¨å…¥(åé¢ä¹Ÿä¼šè®²é€šè¿‡å±æ€§æ³¨å…¥çš„æ–¹æ³•)</strong></li></ul><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bae2b388774d4b069a686bc7d9a85740~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>å¼ºè°ƒä¸€ä¸‹è¿™é‡Œçš„ä¾èµ–æ³¨å…¥ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡ç±»æ„é€ å‡½æ•°æ¥çš„ï¼Œ constructor(private readonly userService: UserService) {}ï¼ŒNestæä¾›äº†IoCå®¹å™¨åˆ©ç”¨Typescriptè‡ªå¸¦ç±»å‹çš„ç‰¹ç‚¹è‡ªåŠ¨åˆ›å»ºå¯¹è±¡çš„èƒ½åŠ›ï¼Œæ³¨æ„è¿™é‡Œæ˜¯å•ä¾‹æ¨¡å¼ï¼Œå¦‚æœè¯¥Serviceåœ¨å…¶å®ƒåœ°æ–¹ä¹Ÿè¢«ç”¨è¿‡ï¼Œé‚£ä¹ˆä¼šåœ¨ä¸ä¼šé‡æ–°åˆ›å»ºå¯¹è±¡ï¼Œå„ä¸ªåº”ç”¨åªä¼šæœ‰ä¸€ä¸ªè¯¥Serviceçš„å¯¹è±¡ï¼Œå®¹å™¨ä¼šå…ˆå¯»æ‰¾å½“å‰æœ‰æ²¡æœ‰ï¼Œå¦‚æœæ²¡æœ‰å†è¿›è¡Œåˆ›å»ºã€‚</p><ul><li><strong>ç”Ÿå‘½å‘¨æœŸï¼šé»˜è®¤æƒ…å†µä¸‹éšç€æ•´ä¸ªåº”ç”¨çš„å¯åŠ¨è€Œäº§ç”Ÿï¼Œéšç€åº”ç”¨çš„å…³é—­è€Œé”€æ¯ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œå¯ä»¥éšç€è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œè°ƒæ•´</strong></li></ul><h3 id="_2-è‡ªå®šä¹‰çš„provider" tabindex="-1">2. è‡ªå®šä¹‰çš„provider <a class="header-anchor" href="#_2-è‡ªå®šä¹‰çš„provider" aria-label="Permalink to &quot;2. è‡ªå®šä¹‰çš„provider&quot;">â€‹</a></h3><p>å°±å¦‚åˆšå¼€å§‹å°†Providerçš„å›¾ç¤ºæ‰€æè¿°çš„ï¼Œproviderå¯ä»¥æ˜¯å•çº¯åœ°å€¼ï¼Œå¯ä»¥æ˜¯ç±»ï¼Œå¯ä»¥ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œå…¶å®ä¸Šé¢ç±»çš„å†™æ³•æ˜¯ä¸€ç§è¯­æ³•ç³–å†™æ³•</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df26a426f4364a439d393b7570543779~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>å¯ä»¥çœ‹å‡ºå®Œæ•´å†™æ³•ï¼Œé€šè¿‡ç»™ä¸åŒçš„provideræ ‡æ³¨ä¸åŒçš„tokenï¼Œæ³¨å…¥çš„æ—¶å€™ä½¿ç”¨@Inject(å¯¹åº”çš„token)è¿›è¡Œæ³¨å…¥</p><p>æ³¨æ„è¿™é‡Œçš„provideå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ç±»åã€stringsã€symbolsæˆ–è€…enumsï¼Œæœ€ä½³å®è·µä¸­ï¼Œä¸€èˆ¬æŠŠæ‰€æœ‰ç”¨åˆ°çš„tokenå•ç‹¬æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚constants.tsï¼Œä¸“é—¨ç”¨æ¥æä¾›ç¨‹åºç”¨åˆ°çš„æ‰€æœ‰tokenã€‚</p><h4 id="usefactory" tabindex="-1">useFactory <a class="header-anchor" href="#usefactory" aria-label="Permalink to &quot;useFactory&quot;">â€‹</a></h4><p>å…³äºå·¥å‚å‡½æ•°useFactoryï¼Œå¤šè¯´å‡ å¥ã€‚å®ƒå¯ä»¥æä¾›åŠ¨æ€çš„providerï¼Œç”±factoryå‡½æ•°çš„è¿”å›å€¼æ¥ç¡®å®šï¼Œfactoryå‡½æ•°å¯ä»¥å¾ˆç®€å•ä¹Ÿå¯ä»¥å¾ˆå¤æ‚ï¼Œå®ƒä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒproviderï¼Œä¸è¿‡éœ€è¦æ³¨å…¥ï¼Œåœ¨injectå±æ€§è¿›è¡Œæ³¨å…¥ï¼Œæ³¨å…¥çš„providerå¯ä»¥æ˜¯å¯é€‰çš„</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">const connectionProvider = {</span></span>
<span class="line"><span style="color:#e1e4e8;">  provide: &#39;CONNECTION&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  useFactory: (optionsProvider: OptionsProvider, optionalProvider?: string) =&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const options = optionsProvider.get();</span></span>
<span class="line"><span style="color:#e1e4e8;">    return new DatabaseConnection(options);</span></span>
<span class="line"><span style="color:#e1e4e8;">  },</span></span>
<span class="line"><span style="color:#e1e4e8;">  inject: [OptionsProvider, { token: &#39;SomeOptionalProvider&#39;, optional: true }],</span></span>
<span class="line"><span style="color:#e1e4e8;">  //       _____________/            __________________/</span></span>
<span class="line"><span style="color:#e1e4e8;">  //        This provider              The provider with this</span></span>
<span class="line"><span style="color:#e1e4e8;">  //        is mandatory.              token can resolve to `undefined`.</span></span>
<span class="line"><span style="color:#e1e4e8;">};</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [</span></span>
<span class="line"><span style="color:#e1e4e8;">    connectionProvider,</span></span>
<span class="line"><span style="color:#e1e4e8;">    OptionsProvider,</span></span>
<span class="line"><span style="color:#e1e4e8;">    // { provide: &#39;SomeOptionalProvider&#39;, useValue: &#39;anything&#39; },</span></span>
<span class="line"><span style="color:#e1e4e8;">  ],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">const connectionProvider = {</span></span>
<span class="line"><span style="color:#24292e;">  provide: &#39;CONNECTION&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  useFactory: (optionsProvider: OptionsProvider, optionalProvider?: string) =&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    const options = optionsProvider.get();</span></span>
<span class="line"><span style="color:#24292e;">    return new DatabaseConnection(options);</span></span>
<span class="line"><span style="color:#24292e;">  },</span></span>
<span class="line"><span style="color:#24292e;">  inject: [OptionsProvider, { token: &#39;SomeOptionalProvider&#39;, optional: true }],</span></span>
<span class="line"><span style="color:#24292e;">  //       _____________/            __________________/</span></span>
<span class="line"><span style="color:#24292e;">  //        This provider              The provider with this</span></span>
<span class="line"><span style="color:#24292e;">  //        is mandatory.              token can resolve to `undefined`.</span></span>
<span class="line"><span style="color:#24292e;">};</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [</span></span>
<span class="line"><span style="color:#24292e;">    connectionProvider,</span></span>
<span class="line"><span style="color:#24292e;">    OptionsProvider,</span></span>
<span class="line"><span style="color:#24292e;">    // { provide: &#39;SomeOptionalProvider&#39;, useValue: &#39;anything&#39; },</span></span>
<span class="line"><span style="color:#24292e;">  ],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre></div><h4 id="useexisting" tabindex="-1">useExisting <a class="header-anchor" href="#useexisting" aria-label="Permalink to &quot;useExisting&quot;">â€‹</a></h4><p>è¿™å…¶å®åªæ˜¯ä¸€ä¸ªåˆ«åçš„ä½¿ç”¨ï¼Œç›¸å½“äºç»™åŒä¸€ä¸ªproviderå¤šä¸ªtokenï¼Œå¦‚ä¸‹ï¼Œå½“æˆ‘ä»¬æ³¨å…¥çš„æ—¶å€™@Inject(&#39;AliasedLoggerService&#39;)å’Œ@Inject(LoggerService)ï¼Œæœ€ç»ˆä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªLoggerServiceçš„å®ä¾‹</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">class LoggerService {</span></span>
<span class="line"><span style="color:#e1e4e8;">  /* implementation details */</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">const loggerAliasProvider = {</span></span>
<span class="line"><span style="color:#e1e4e8;">  provide: &#39;AliasedLoggerService&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  useExisting: LoggerService,</span></span>
<span class="line"><span style="color:#e1e4e8;">};</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [LoggerService, loggerAliasProvider],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">class LoggerService {</span></span>
<span class="line"><span style="color:#24292e;">  /* implementation details */</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">const loggerAliasProvider = {</span></span>
<span class="line"><span style="color:#24292e;">  provide: &#39;AliasedLoggerService&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  useExisting: LoggerService,</span></span>
<span class="line"><span style="color:#24292e;">};</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [LoggerService, loggerAliasProvider],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre></div><p>æƒ³äº†è§£æ›´å¤šå…³äºè‡ªå®šä¹‰providerçš„çŸ¥è¯†ï¼Œè¯·ç§»æ­¥å®˜ç½‘ï¼š<a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank" rel="noreferrer">https://docs.nestjs.com/fundamentals/custom-providers</a></p><h3 id="_3-è·¨æ¨¡å—å…±äº«æœåŠ¡" tabindex="-1">3. è·¨æ¨¡å—å…±äº«æœåŠ¡ <a class="header-anchor" href="#_3-è·¨æ¨¡å—å…±äº«æœåŠ¡" aria-label="Permalink to &quot;3. è·¨æ¨¡å—å…±äº«æœåŠ¡&quot;">â€‹</a></h3><p>providerå…·æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œé»˜è®¤åªåœ¨å£°æ˜providerçš„æ¨¡å—å†…èµ·æ•ˆã€‚å¦‚æœè¦è·¨æ¨¡å—è¿›è¡Œå…±äº«ï¼Œå‰ææ˜¯è¯¥æœåŠ¡è¦åœ¨åœ¨moduleä¸­è¿›è¡Œå¯¼å‡ºï¼Œä¹Ÿå°±æ˜¯exportsæ“ä½œï¼Œexportså¯ä»¥å¡«å…¥å®Œæ•´çš„providerï¼Œä¹Ÿå¯ä»¥åªå¡«å®ƒçš„token(tokenåé¢ä¼šè¯´)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  controllers: [UserController],</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: [UserService],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class UserModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  controllers: [UserController],</span></span>
<span class="line"><span style="color:#24292e;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#24292e;">  exports: [UserService],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class UserModule {}</span></span></code></pre></div><p>å…¶å®ƒæ¨¡å—æƒ³ä½¿ç”¨çš„è¯å¯ä»¥ç›´æ¥åœ¨moduleçš„importsä¸­æ·»åŠ è¯¥æ¨¡å—æˆ–è€…åœ¨providersä¸­æ·»åŠ è¯¥æœåŠ¡</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  // æ–¹æ³•ä¸€</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [UserModule],</span></span>
<span class="line"><span style="color:#e1e4e8;">  // æ–¹æ³•äºŒ</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class UserModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  // æ–¹æ³•ä¸€</span></span>
<span class="line"><span style="color:#24292e;">  imports: [UserModule],</span></span>
<span class="line"><span style="color:#24292e;">  // æ–¹æ³•äºŒ</span></span>
<span class="line"><span style="color:#24292e;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class UserModule {}</span></span></code></pre></div><p>æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨å…¨å±€æ¨¡å—ï¼Œä¸ºModuleå¢åŠ @Global()è£…é¥°å™¨ï¼Œæ¯”å¦‚æˆ‘çš„æ•°æ®åº“Ormçš„Moduleå°±ä½œä¸ºäº†å…¨å±€æ¨¡å—</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Global, Module } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { PrismaService } from &#39;./prisma.service&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Global()</span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [PrismaService],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: [PrismaService],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class PrismaModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Global, Module } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { PrismaService } from &#39;./prisma.service&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Global()</span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [PrismaService],</span></span>
<span class="line"><span style="color:#24292e;">  exports: [PrismaService],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class PrismaModule {}</span></span></code></pre></div><p>å½“ç„¶ï¼Œå’±ä»¬æ‰€æœ‰çš„æ¨¡å—éƒ½éœ€è¦åœ¨æ ¹æ¨¡å—AppModuleä¸­çš„importså¼•å…¥è¿›å»</p><h3 id="_4-å¯é€‰çš„provider" tabindex="-1">4.å¯é€‰çš„provider <a class="header-anchor" href="#_4-å¯é€‰çš„provider" aria-label="Permalink to &quot;4.å¯é€‰çš„provider&quot;">â€‹</a></h3><p>æœ‰äº›æ—¶å€™å¯èƒ½ä¸éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªæœåŠ¡ç±»ï¼Œå¯èƒ½éœ€è¦æ ¹æ®é…ç½®æ–‡ä»¶çµæ´»å¤„ç†ï¼Œè¿™æ—¶å€™å¯ä»¥ç»™å¯¹åº”çš„æ³¨å…¥æœåŠ¡å†å¢åŠ ä¸€ä¸ª@Optional()è£…é¥°å™¨å°±è¡Œ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">constructor(@Optional() @Inject(&#39;service&#39;) private service: xxxService) {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">constructor(@Optional() @Inject(&#39;service&#39;) private service: xxxService) {}</span></span></code></pre></div><h3 id="_5-é€šè¿‡å±æ€§æ³¨å…¥" tabindex="-1">5. é€šè¿‡å±æ€§æ³¨å…¥ <a class="header-anchor" href="#_5-é€šè¿‡å±æ€§æ³¨å…¥" aria-label="Permalink to &quot;5. é€šè¿‡å±æ€§æ³¨å…¥&quot;">â€‹</a></h3><p>è¿™ç§æ³¨å…¥æ–¹å¼ç”¨çš„æå°‘ï¼Œä¸€ç§æƒ…å†µæ˜¯ä½ çš„é¡¶çº§æœåŠ¡ç±»classä¾èµ–äº†ä¸€ä¸ªæˆ–å¤šä¸ªprovidersï¼Œå®ƒçš„åä»£classå°†ä¸€ç›´é€šè¿‡super()çš„æ–¹å¼è¿›è¡Œæ„é€ ï¼Œæƒ³æƒ³ä¹Ÿè¿˜æ˜¯æ¯”è¾ƒå¯æ€•çš„ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨å±æ€§æ„é€ çš„æ–¹æ³•ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Injectable, Inject } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class HttpService&lt;T&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  @Inject(&#39;HTTP_OPTIONS&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">  private readonly httpClient: T;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Injectable, Inject } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class HttpService&lt;T&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  @Inject(&#39;HTTP_OPTIONS&#39;)</span></span>
<span class="line"><span style="color:#24292e;">  private readonly httpClient: T;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>å¦‚æœä½ çš„æœåŠ¡ç±»æ²¡æœ‰ç»§æ‰¿è‡ªåˆ«çš„ç±»ï¼Œé‚£è¯·ç»§ç»­ä½¿ç”¨constructoræ„é€ å‡½æ•°æ¥æ³¨å…¥</p><h2 id="ä¸‰ã€modules" tabindex="-1">ä¸‰ã€Modules <a class="header-anchor" href="#ä¸‰ã€modules" aria-label="Permalink to &quot;ä¸‰ã€Modules&quot;">â€‹</a></h2><p>A module is a class annotated with a @Module() decorator. The @Module() decorator provides metadata that <strong>Nest</strong> makes use of to organize the application structure.</p><p>å¯ä»¥çœ‹å‡ºï¼Œnestjsä¹Ÿæ˜¯æ¨¡å—åŒ–ç¼–ç¨‹çš„æ€æƒ³ï¼Œä¸€ä¸ªåº”ç”¨ç”±ä¸€ä¸ªä¸ªæ‹†åˆ†çš„æ¨¡å—æ¥ç»„æˆï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£è‡ªå·±çš„ä¸€éƒ¨åˆ†ä¸šåŠ¡ï¼Œä¸€ä¸ªåº”ç”¨è‡³å°‘æœ‰ä¸€ä¸ªæ¨¡å—ï¼Œä¹Ÿå°±æ˜¯æ ¹æ¨¡å—ï¼Œä½¿ç”¨@Module()è£…é¥°å™¨æ¥å£°æ˜ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—ä¹Ÿæ˜¯ä¸€ä¸ªç±»ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ccda297aaf148a2818955d21233ff4c~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h3 id="_1-module-è£…é¥°å™¨" tabindex="-1">1. @Module()è£…é¥°å™¨ <a class="header-anchor" href="#_1-module-è£…é¥°å™¨" aria-label="Permalink to &quot;1. @Module()è£…é¥°å™¨&quot;">â€‹</a></h3><p>éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢åŒ…å«å››ä¸ªå±æ€§ï¼Œç”¨æ¥æè¿°è¿™ä¸ªmoduleï¼Œä¸Šé¢å…¶å®å·²ç»éƒ½è®²åˆ°äº†</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [OtherModule],</span></span>
<span class="line"><span style="color:#e1e4e8;">  controllers: [UserController],</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports:[UserService]</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class UserModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [OtherModule],</span></span>
<span class="line"><span style="color:#24292e;">  controllers: [UserController],</span></span>
<span class="line"><span style="color:#24292e;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#24292e;">  exports:[UserService]</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class UserModule {}</span></span></code></pre></div><p>å¯¹äºimportsä¸­å¯¼å…¥çš„OtherModuleï¼Œæ„å‘³ç€OtherModuleé‡Œexportsçš„providerï¼Œå¯ä»¥åœ¨UserModuleä¸­ä½¿ç”¨</p><p>exportså¯ä»¥ä½¿ç”¨provideræœ¬èº«ï¼Œäº¦å¯ä»¥ä½¿ç”¨providerçš„token</p><h3 id="_2-æ¨¡å—å…±äº«" tabindex="-1">2. æ¨¡å—å…±äº« <a class="header-anchor" href="#_2-æ¨¡å—å…±äº«" aria-label="Permalink to &quot;2. æ¨¡å—å…±äº«&quot;">â€‹</a></h3><p>åœ¨Providerä¸­å·²ç»è®²è¿‡äº†ï¼Œå°±æ˜¯é€šè¿‡exportså¯¼å‡ºç›¸åº”çš„Serviceï¼Œåœ¨åˆ«çš„æ¨¡å—é€šè¿‡importså¯¼å…¥è¯¥æ¨¡å—</p><h3 id="_3-æ¨¡å—é‡å¯¼å‡º" tabindex="-1">3. æ¨¡å—é‡å¯¼å‡º <a class="header-anchor" href="#_3-æ¨¡å—é‡å¯¼å‡º" aria-label="Permalink to &quot;3. æ¨¡å—é‡å¯¼å‡º&quot;">â€‹</a></h3><p>è¿™ä¸ªæ„Ÿè§‰è¿˜æ˜¯æŒºæœ‰ç”¨çš„ï¼Œå¯ä»¥æŠŠä¸€äº›å¸¸ç”¨çš„ï¼Œå…¬å…±çš„æ¨¡å—ï¼Œå…¨éƒ¨å…ˆimportè¿›ä¸€ä¸ªCommonModuleï¼Œç„¶åå†æŠŠå®ƒä»¬ä»exprotså…¨éƒ¨å¯¼å‡ºï¼Œä»¥åå¦‚æœæœ‰é‚£ä¸ªæ¨¡å—æƒ³è¦ä½¿ç”¨å…¶ä¸­æŸä¸ªæ¨¡å—çš„Serviceï¼Œåªéœ€è¦å°†è¿™ä¸ªCommonModuleå¯¼å…¥å³å¯ï¼Œä¸ç”¨å†å¯¼å…¥æ‰€æœ‰çš„ä¾èµ–æ¨¡å—</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [Module1, Module2, Module3, Module4],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: [Module1, Module2, Module3, Module4],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CommonModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [Module1, Module2, Module3, Module4],</span></span>
<span class="line"><span style="color:#24292e;">  exports: [Module1, Module2, Module3, Module4],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class CommonModule {}</span></span></code></pre></div><h3 id="_4-æ¨¡å—ç±»ä¸­ä¹Ÿå¯ä»¥æ³¨å…¥service" tabindex="-1">4. æ¨¡å—ç±»ä¸­ä¹Ÿå¯ä»¥æ³¨å…¥Service <a class="header-anchor" href="#_4-æ¨¡å—ç±»ä¸­ä¹Ÿå¯ä»¥æ³¨å…¥service" aria-label="Permalink to &quot;4. æ¨¡å—ç±»ä¸­ä¹Ÿå¯ä»¥æ³¨å…¥Service&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Module } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { CatsController } from &#39;./cats.controller&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { CatsService } from &#39;./cats.service&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  controllers: [CatsController],</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [CatsService],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CatsModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  constructor(private catsService: CatsService) {}</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Module } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { CatsController } from &#39;./cats.controller&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { CatsService } from &#39;./cats.service&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  controllers: [CatsController],</span></span>
<span class="line"><span style="color:#24292e;">  providers: [CatsService],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class CatsModule {</span></span>
<span class="line"><span style="color:#24292e;">  constructor(private catsService: CatsService) {}</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h3 id="_5-å…¨å±€æ¨¡å—global-modules" tabindex="-1">5. å…¨å±€æ¨¡å—Global modules <a class="header-anchor" href="#_5-å…¨å±€æ¨¡å—global-modules" aria-label="Permalink to &quot;5. å…¨å±€æ¨¡å—Global modules&quot;">â€‹</a></h3><p>é€šè¿‡@Global()è£…é¥°å™¨å£°æ˜ä¸€ä¸ªå…¨å±€æ¨¡å—ï¼Œåªéœ€è¦åœ¨æ ¹æ¨¡å—importsæ³¨å†Œè¯¥å…¨å±€æ¨¡å—ï¼Œå°±å¯ä»¥åœ¨å…¶ä»–æ‰€æœ‰æ¨¡å—å†…ä½¿ç”¨å®ƒå¯¼å‡ºçš„Service</p><h3 id="_6-åŠ¨æ€æ¨¡å—dynamic-modules" tabindex="-1">6. åŠ¨æ€æ¨¡å—Dynamic modules <a class="header-anchor" href="#_6-åŠ¨æ€æ¨¡å—dynamic-modules" aria-label="Permalink to &quot;6. åŠ¨æ€æ¨¡å—Dynamic modules&quot;">â€‹</a></h3><p>è¿™æ˜¯nestæä¾›çš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥è®©æˆ‘ä»¬å¯¹æ¨¡å—è¿›è¡Œå®šåˆ¶åŒ–æ“ä½œï¼Œè‡ªå®šä¹‰æ¨¡å—çš„æ³¨å†Œï¼ŒåŠ¨æ€æä¾›providersï¼Œçœ‹ä¸€ä¸‹å®˜æ–¹çš„ç¤ºä¾‹</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Module, DynamicModule } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { createDatabaseProviders } from &#39;./database.providers&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Connection } from &#39;./connection.provider&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [Connection],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class DatabaseModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  static forRoot(entities = [], options?): DynamicModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const providers = createDatabaseProviders(options, entities);</span></span>
<span class="line"><span style="color:#e1e4e8;">    return {</span></span>
<span class="line"><span style="color:#e1e4e8;">      module: DatabaseModule,</span></span>
<span class="line"><span style="color:#e1e4e8;">      providers: providers,</span></span>
<span class="line"><span style="color:#e1e4e8;">      exports: providers,</span></span>
<span class="line"><span style="color:#e1e4e8;">    };</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Module, DynamicModule } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { createDatabaseProviders } from &#39;./database.providers&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Connection } from &#39;./connection.provider&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [Connection],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class DatabaseModule {</span></span>
<span class="line"><span style="color:#24292e;">  static forRoot(entities = [], options?): DynamicModule {</span></span>
<span class="line"><span style="color:#24292e;">    const providers = createDatabaseProviders(options, entities);</span></span>
<span class="line"><span style="color:#24292e;">    return {</span></span>
<span class="line"><span style="color:#24292e;">      module: DatabaseModule,</span></span>
<span class="line"><span style="color:#24292e;">      providers: providers,</span></span>
<span class="line"><span style="color:#24292e;">      exports: providers,</span></span>
<span class="line"><span style="color:#24292e;">    };</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>åŸç†å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ç»™å½“å‰Moduleç±»æä¾›ä¸€ä¸ªforRootæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„Moduleï¼Œè¿™ä¸ªModuleçš„ç±»å‹æ˜¯ä¸€ä¸ªDynamicModuleï¼Œåœ¨å…¶ä»–æ¨¡å—éœ€è¦æ³¨å†Œä½¿ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨DatabaseModule.forRoot(å‚æ•°)æ¥åŠ¨æ€çš„æ³¨å†Œä¸åŒçš„Moduleï¼Œä»¥è¾¾åˆ°æä¾›ä¸åŒprovidersçš„ç›®çš„ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [DatabaseModule.forRoot([User])],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [DatabaseModule.forRoot([User])],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre></div><p><strong>å¦‚æœæƒ³åœ¨å…¨å±€ä½œç”¨åŸŸå†…æ³¨å†Œä¸€ä¸ªåŠ¨æ€Moduleï¼Œåˆ™åœ¨forRootæ–¹æ³•çš„è¿”å›å€¼å¯¹è±¡ä¸­åŠ å…¥global:trueè¿™ä¸ªå±æ€§ï¼Œå½“ç„¶ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œnestjså…¶å®ä¸æå€¡æå…¨å±€æ¨¡å—çš„ï¼Œæˆ‘ä»¬æŒ‰éœ€ä½¿ç”¨å°±è¡Œã€‚</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  global: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">  module: DatabaseModule,</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: providers,</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: providers,</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  global: true,</span></span>
<span class="line"><span style="color:#24292e;">  module: DatabaseModule,</span></span>
<span class="line"><span style="color:#24292e;">  providers: providers,</span></span>
<span class="line"><span style="color:#24292e;">  exports: providers,</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p><strong>åŠ¨æ€æ¨¡å—çš„é‡å¯¼å‡ºå¯ä»¥çœç•¥forRoot()æ–¹æ³•ï¼Œå¦‚</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [DatabaseModule.forRoot([User])],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: [DatabaseModule],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [DatabaseModule.forRoot([User])],</span></span>
<span class="line"><span style="color:#24292e;">  exports: [DatabaseModule],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre></div><h2 id="å››ã€middleware" tabindex="-1">å››ã€Middleware <a class="header-anchor" href="#å››ã€middleware" aria-label="Permalink to &quot;å››ã€Middleware&quot;">â€‹</a></h2><p>Middleware is a function which is called <strong>before</strong> the route handler. Middleware functions have access to the <a href="https://expressjs.com/en/4x/api.html#req" target="_blank" rel="noreferrer">request</a> and <a href="https://expressjs.com/en/4x/api.html#res" target="_blank" rel="noreferrer">response</a> objects, and the next() middleware function in the applicationâ€™s request-response cycle. The <strong>next</strong> middleware function is commonly denoted by a variable named next.</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d15accfc9be34cf99a5fb542d4914792~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p><strong>ä¸­é—´ä»¶</strong>ï¼Œå­¦è¿‡Expresså’ŒKoaçš„åŒå­¦ï¼Œå¯¹ä¸­é—´ä»¶è¿™ä¸ªæ¦‚å¿µåº”è¯¥å¾ˆç†Ÿæ‚‰äº†ã€‚çœ‹å®˜æ–¹è¯´æ˜ï¼Œä¸­é—´ä»¶å¯ä»¥æ‹¿åˆ°Requestã€Responseå¯¹è±¡åŠnextå‡½æ•°ï¼Œå…¶å®nesté»˜è®¤å’Œexpressçš„ä¸­é—´ä»¶æ˜¯ç­‰æ•ˆçš„</p><p>å†æ¥å›å¿†ä¸€ä¸‹ä¸­é—´ä»¶çš„åŠŸèƒ½ç‰¹æ€§ï¼š</p><ul><li>å¯ä»¥æ‰§è¡Œä»»æ„çš„ä»£ç </li><li>å¯¹requestå’Œresponseå¯¹è±¡è¿›è¡Œæ”¹é€ </li><li>ç»“æŸrequest-responseå¾ªç¯</li><li>é€šè¿‡next()è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</li><li>å¦‚æœå½“å‰ä¸­é—´ä»¶æ²¡æœ‰ç»“æŸå½“å‰request-responseå¾ªç¯ï¼Œå¿…é¡»è°ƒç”¨next()å‡½æ•°ï¼Œå¦åˆ™è¯·æ±‚ä¼šå¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œé˜»å¡æ•´ä¸ªåº”ç”¨</li></ul><p>æ„é€ ä¸­é—´ä»¶çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é€šè¿‡å‡½æ•°ï¼Œä¸€ç§æ˜¯é€šè¿‡ç±»ï¼Œä¸‹é¢çœ‹ç±»çš„æ–¹å¼</p><h3 id="_1-åˆ›å»ºç±»ä¸­é—´ä»¶" tabindex="-1">1. åˆ›å»ºç±»ä¸­é—´ä»¶ <a class="header-anchor" href="#_1-åˆ›å»ºç±»ä¸­é—´ä»¶" aria-label="Permalink to &quot;1. åˆ›å»ºç±»ä¸­é—´ä»¶&quot;">â€‹</a></h3><p>éœ€è¦ä½¿ç”¨@Injectable()è£…é¥°å™¨ï¼Œç±»éœ€è¦å®ç°NestMiddlewareæ¥å£(é‡Œé¢å®ç°useæ–¹æ³•)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Injectable, NestMiddleware } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Request, Response, NextFunction } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class LoggerMiddleware implements NestMiddleware {</span></span>
<span class="line"><span style="color:#e1e4e8;">  use(req: Request, res: Response, next: NextFunction) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;Request...&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    next();</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Injectable, NestMiddleware } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Request, Response, NextFunction } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class LoggerMiddleware implements NestMiddleware {</span></span>
<span class="line"><span style="color:#24292e;">  use(req: Request, res: Response, next: NextFunction) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;Request...&#39;);</span></span>
<span class="line"><span style="color:#24292e;">    next();</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h3 id="_2-åº”ç”¨ç±»ä¸­é—´ä»¶" tabindex="-1">2. åº”ç”¨ç±»ä¸­é—´ä»¶ <a class="header-anchor" href="#_2-åº”ç”¨ç±»ä¸­é—´ä»¶" aria-label="Permalink to &quot;2. åº”ç”¨ç±»ä¸­é—´ä»¶&quot;">â€‹</a></h3><p>æˆ‘ä»¬çŸ¥é“@Module()è£…é¥°å™¨å†…æ²¡æœ‰ç»™middlewareçš„é…ç½®ï¼Œé‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨moduleç±»ä¸­ä½¿ç”¨configè¿›è¡ŒåŠ è½½ï¼Œéœ€è¦è®©moduleç±»å®ç°NestModuleæ¥å£ï¼Œå®ç°é‡Œé¢configureæ–¹æ³•è¿›è¡Œ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [],</span></span>
<span class="line"><span style="color:#e1e4e8;">  controllers: [],</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  configure(consumer: MiddlewareConsumer): any {</span></span>
<span class="line"><span style="color:#e1e4e8;">    consumer.apply(LoggerMiddleware).forRoutes(&#39;&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [],</span></span>
<span class="line"><span style="color:#24292e;">  controllers: [],</span></span>
<span class="line"><span style="color:#24292e;">  providers: [],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#24292e;">  configure(consumer: MiddlewareConsumer): any {</span></span>
<span class="line"><span style="color:#24292e;">    consumer.apply(LoggerMiddleware).forRoutes(&#39;&#39;);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>applyæ–¹æ³•è¡¨åè¦åŠ è½½çš„æ˜¯å“ªä¸ªä¸­é—´ä»¶ï¼ŒforRootesæ–¹æ³•è¡¨åå¯¹å“ªä¸ªè¯·æ±‚è·¯å¾„èµ·ä½œç”¨ï¼Œè¿™ä¸ªå’Œapp.use(è·¯å¾„, ä¸­é—´ä»¶)å¦‚å‡ºä¸€è¾™ï¼Œè¿™é‡Œè¿˜å¯ä»¥å¯¹forRoutesè¿›è¡Œæ›´è¯¦ç»†çš„é…ç½®ï¼Œä¼ å…¥ä¸€ä¸ªå¯¹è±¡é’ˆå¯¹ç‰¹å®šçš„æŸä¸€ä¸ªè¯·æ±‚ï¼Œpathå¯ä»¥ä½¿ç”¨æ­£åˆ™åŒ¹é…ï¼Ÿã€+ã€<em>ã€()ç­‰ï¼Œä½¿ç”¨fastifyé©±åŠ¨çš„éœ€è¦æ³¨æ„ä¸èƒ½ä½¿ç”¨</em>ï¼Œå¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">      .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#e1e4e8;">      .forRoutes({ path: &#39;ab*cd&#39;, method: RequestMethod.GET });</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#24292e;">  configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#24292e;">    consumer</span></span>
<span class="line"><span style="color:#24292e;">      .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#24292e;">      .forRoutes({ path: &#39;ab*cd&#39;, method: RequestMethod.GET });</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p><strong>æ³¨æ„ï¼Œconfigureæ–¹æ³•å¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚æœé‡Œé¢æœ‰éœ€è¦å¼‚æ­¥å¤„ç†çš„æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨async/awaitæ¥ç­‰å¾…æ“ä½œå®Œæˆå†å¾€ä¸‹è¿›è¡Œ</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  async configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    await ...</span></span>
<span class="line"><span style="color:#e1e4e8;">    consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">      .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#e1e4e8;">      .forRoutes({ path: &#39;cats&#39;, method: RequestMethod.GET });</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#24292e;">  async configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#24292e;">    await ...</span></span>
<span class="line"><span style="color:#24292e;">    consumer</span></span>
<span class="line"><span style="color:#24292e;">      .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#24292e;">      .forRoutes({ path: &#39;cats&#39;, method: RequestMethod.GET });</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹Nestjsåº”ç”¨ä½¿ç”¨expressé©±åŠ¨ï¼Œä¼šä½¿ç”¨body-parseræ¥è§£æresponseçš„æ•°æ®ï¼Œå¦‚æœä½ æƒ³è‡ªå®šä¹‰çš„è¯ï¼Œéœ€è¦åœ¨NestFactory.create()æ—¶å°†bodyParserç½®ä¸ºfalse</p><h4 id="middlewareconsumer" tabindex="-1">MiddlewareConsumer <a class="header-anchor" href="#middlewareconsumer" aria-label="Permalink to &quot;MiddlewareConsumer&quot;">â€‹</a></h4><ul><li>å®ç°é“¾å¼è°ƒç”¨</li><li>applyå¯ä»¥æ”¾ç½®å¤šä¸ªmiddleware</li><li>forRouteså¯ä»¥ä½¿ç”¨å•ä¸ªstringè·¯å¾„ï¼Œå¤šä¸ªstringè·¯å¾„ï¼ŒRouteInfoå¯¹è±¡ï¼Œå•ä¸ªControllerï¼Œå¤šä¸ªController</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">      .apply(LoggerMiddleware, xxxMiddleware,...)</span></span>
<span class="line"><span style="color:#e1e4e8;">      .forRoutes(CatsController,UserController,...);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#24292e;">  configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#24292e;">    consumer</span></span>
<span class="line"><span style="color:#24292e;">      .apply(LoggerMiddleware, xxxMiddleware,...)</span></span>
<span class="line"><span style="color:#24292e;">      .forRoutes(CatsController,UserController,...);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><ul><li>excludeå¯ä»¥æ’é™¤ä¸ä½¿ç”¨ä¸­é—´ä»¶çš„è·¯å¾„</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">  .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#e1e4e8;">  .exclude(</span></span>
<span class="line"><span style="color:#e1e4e8;">    { path: &#39;cats&#39;, method: RequestMethod.GET },</span></span>
<span class="line"><span style="color:#e1e4e8;">    { path: &#39;cats&#39;, method: RequestMethod.POST },</span></span>
<span class="line"><span style="color:#e1e4e8;">    &#39;cats/(.*)&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  )</span></span>
<span class="line"><span style="color:#e1e4e8;">  .forRoutes(CatsController);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">consumer</span></span>
<span class="line"><span style="color:#24292e;">  .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#24292e;">  .exclude(</span></span>
<span class="line"><span style="color:#24292e;">    { path: &#39;cats&#39;, method: RequestMethod.GET },</span></span>
<span class="line"><span style="color:#24292e;">    { path: &#39;cats&#39;, method: RequestMethod.POST },</span></span>
<span class="line"><span style="color:#24292e;">    &#39;cats/(.*)&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  )</span></span>
<span class="line"><span style="color:#24292e;">  .forRoutes(CatsController);</span></span></code></pre></div><h3 id="_3-å‡½æ•°å¼ä¸­é—´ä»¶" tabindex="-1">3. å‡½æ•°å¼ä¸­é—´ä»¶ <a class="header-anchor" href="#_3-å‡½æ•°å¼ä¸­é—´ä»¶" aria-label="Permalink to &quot;3. å‡½æ•°å¼ä¸­é—´ä»¶&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Request, Response, NextFunction } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export function logger(req: Request, res: Response, next: NextFunction) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(`Request...`);</span></span>
<span class="line"><span style="color:#e1e4e8;">  next</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Request, Response, NextFunction } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export function logger(req: Request, res: Response, next: NextFunction) {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(`Request...`);</span></span>
<span class="line"><span style="color:#24292e;">  next</span></span></code></pre></div><p>ä½¿ç”¨</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">  .apply(logger)</span></span>
<span class="line"><span style="color:#e1e4e8;">  .forRoutes(CatsController);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">consumer</span></span>
<span class="line"><span style="color:#24292e;">  .apply(logger)</span></span>
<span class="line"><span style="color:#24292e;">  .forRoutes(CatsController);</span></span></code></pre></div><p>å¦‚æœä½ çš„ä¸­é—´ä»¶ä¸éœ€è¦ä¾èµ–å…¶å®ƒä¸œè¥¿æ—¶ï¼Œå¯ä»¥å°½å¯èƒ½ä½¿ç”¨å‡½æ•°å¼ä¸­é—´ä»¶ï¼Œè¾ƒä¸ºç®€å•</p><h3 id="_4-å…¨å±€ä¸­é—´ä»¶" tabindex="-1">4. å…¨å±€ä¸­é—´ä»¶ <a class="header-anchor" href="#_4-å…¨å±€ä¸­é—´ä»¶" aria-label="Permalink to &quot;4. å…¨å±€ä¸­é—´ä»¶&quot;">â€‹</a></h3><p>åœ¨main.tsä¸­ç›´æ¥ä½¿ç”¨app.use(ä¸­é—´ä»¶)</p><p>å¦‚ç»å¸¸æ·»åŠ çš„è§£å†³è·¨åŸŸçš„ä¸­é—´ä»¶(ä¸‹é¢è¿˜è‡ªå®šä¹‰äº†loggeræ—¥å¿—ç³»ç»Ÿï¼Œåé¢æŠ½ç©ºå†å•ç‹¬å‡ºä¸€ç¯‡å…³äºæ—¥å¿—çš„)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  // ä½¿ç”¨è‡ªå®šä¹‰winstonæ—¥å¿—</span></span>
<span class="line"><span style="color:#e1e4e8;">  const app = await NestFactory.create&lt;NestExpressApplication&gt;(AppModule, {</span></span>
<span class="line"><span style="color:#e1e4e8;">    logger: WinstonModule.createLogger({</span></span>
<span class="line"><span style="color:#e1e4e8;">      instance: logInstance,</span></span>
<span class="line"><span style="color:#e1e4e8;">    }),</span></span>
<span class="line"><span style="color:#e1e4e8;">  });</span></span>
<span class="line"><span style="color:#e1e4e8;">  // è·¨åŸŸè®¾ç½®</span></span>
<span class="line"><span style="color:#e1e4e8;">  app.use(cors());</span></span>
<span class="line"><span style="color:#e1e4e8;">  await app.listen(7777);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">bootstrap();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#24292e;">  // ä½¿ç”¨è‡ªå®šä¹‰winstonæ—¥å¿—</span></span>
<span class="line"><span style="color:#24292e;">  const app = await NestFactory.create&lt;NestExpressApplication&gt;(AppModule, {</span></span>
<span class="line"><span style="color:#24292e;">    logger: WinstonModule.createLogger({</span></span>
<span class="line"><span style="color:#24292e;">      instance: logInstance,</span></span>
<span class="line"><span style="color:#24292e;">    }),</span></span>
<span class="line"><span style="color:#24292e;">  });</span></span>
<span class="line"><span style="color:#24292e;">  // è·¨åŸŸè®¾ç½®</span></span>
<span class="line"><span style="color:#24292e;">  app.use(cors());</span></span>
<span class="line"><span style="color:#24292e;">  await app.listen(7777);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">bootstrap();</span></span></code></pre></div><h2 id="äº”ã€exception-filters" tabindex="-1">äº”ã€Exception filters <a class="header-anchor" href="#äº”ã€exception-filters" aria-label="Permalink to &quot;äº”ã€Exception filters&quot;">â€‹</a></h2><p>Nest comes with a built-in <strong>exceptions layer</strong> which is responsible for processing all unhandled exceptions across an application. When an exception is not handled by your application code, it is caught by this layer, which then automatically sends an appropriate user-friendly response.</p><p>nestå†…ç½®äº†ä¸€ä¸ªå¼‚å¸¸å¤„ç†å±‚ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ‰‹åŠ¨å¤„ç†å¼‚å¸¸ï¼Œæ‰€æœ‰çš„å¼‚å¸¸éƒ½ä¼šè¿›åˆ°è¿™é‡Œï¼Œç³»ç»Ÿå°†ç»™å‡ºå“åº”çš„æç¤ºä¿¡æ¯ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a6de167abec43d7bb8c1be759105d64~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>å¦‚æœæ²¡æœ‰æ‰‹åŠ¨åšå¤„ç†ï¼Œå‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œresponseè¿”å›ç»™å‰ç«¯çš„ä¿¡æ¯å°†æ˜¯å¦‚ä¸‹å½¢å¼ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;statusCode&quot;: 500,</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;message&quot;: &quot;Internal server error&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  &quot;statusCode&quot;: 500,</span></span>
<span class="line"><span style="color:#24292e;">  &quot;message&quot;: &quot;Internal server error&quot;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h3 id="_1-æŠ›å‡ºæ ‡å‡†å¼‚å¸¸" tabindex="-1">1. æŠ›å‡ºæ ‡å‡†å¼‚å¸¸ <a class="header-anchor" href="#_1-æŠ›å‡ºæ ‡å‡†å¼‚å¸¸" aria-label="Permalink to &quot;1. æŠ›å‡ºæ ‡å‡†å¼‚å¸¸&quot;">â€‹</a></h3><p>nestå†…ç½®äº†HttpExceptionï¼Œå¯ä»¥ç›´æ¥æŠ›å‡ºè¯¥å¼‚å¸¸</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get()</span></span>
<span class="line"><span style="color:#e1e4e8;">async findAll() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  throw new HttpException(&#39;Forbidden&#39;, HttpStatus.FORBIDDEN);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get()</span></span>
<span class="line"><span style="color:#24292e;">async findAll() {</span></span>
<span class="line"><span style="color:#24292e;">  throw new HttpException(&#39;Forbidden&#39;, HttpStatus.FORBIDDEN);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>å®¢æˆ·ç«¯è¯·æ±‚çš„å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;statusCode&quot;: 403,</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;message&quot;: &quot;Forbidden&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  &quot;statusCode&quot;: 403,</span></span>
<span class="line"><span style="color:#24292e;">  &quot;message&quot;: &quot;Forbidden&quot;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3920f483b8d740f68e452918e2435dca~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>å…³äºå‚æ•°ï¼š</p><ul><li>ç¬¬1ä¸ªå‚æ•°æ˜¯responseï¼Œå®šä¹‰äº†è¿”å›ç»™å‰ç«¯çš„response bodyï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡</li><li>ç¬¬2ä¸ªå‚æ•°æ˜¯statusï¼Œå®šä¹‰äº†HTTPçš„çŠ¶æ€ç ï¼Œä¸€èˆ¬ä½¿ç”¨æšä¸¾æ¥èµ‹å€¼ï¼Œå¦‚HttpStatus.FORBIDDEN</li><li>ç¬¬3ä¸ªå‚æ•°æ˜¯å¯é€‰çš„é¢å¤–é…ç½®å‚æ•°ï¼Œæä¾›ä¸€ä¸ªcauseå±æ€§ï¼Œæ¥æ”¶é”™è¯¯ï¼Œåœ¨æ—¥å¿—è®°å½•æ–¹é¢æ¯”è¾ƒæœ‰ç”¨</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">getHello(@Request() req) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  throw new HttpException(</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      status: HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#e1e4e8;">      error: &#39;this is a error msg&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      custom: &#39;this is a custom res&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">    HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      cause: new Error(&#39;å®é™…çš„é”™è¯¯ä¿¡æ¯&#39;),</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">  );</span></span>
<span class="line"><span style="color:#e1e4e8;">  return req.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">getHello(@Request() req) {</span></span>
<span class="line"><span style="color:#24292e;">  throw new HttpException(</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      status: HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#24292e;">      error: &#39;this is a error msg&#39;,</span></span>
<span class="line"><span style="color:#24292e;">      custom: &#39;this is a custom res&#39;,</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">    HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      cause: new Error(&#39;å®é™…çš„é”™è¯¯ä¿¡æ¯&#39;),</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">  );</span></span>
<span class="line"><span style="color:#24292e;">  return req.user;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>è¯·æ±‚è¿”å›å€¼å°†å˜æˆï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  status: HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#e1e4e8;">  error: &#39;this is a error msg&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  custom: &#39;this is a custom res&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">},</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  status: HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#24292e;">  error: &#39;this is a error msg&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  custom: &#39;this is a custom res&#39;,</span></span>
<span class="line"><span style="color:#24292e;">},</span></span></code></pre></div><h3 id="_2-è‡ªå®šä¹‰å¼‚å¸¸" tabindex="-1">2. è‡ªå®šä¹‰å¼‚å¸¸ <a class="header-anchor" href="#_2-è‡ªå®šä¹‰å¼‚å¸¸" aria-label="Permalink to &quot;2. è‡ªå®šä¹‰å¼‚å¸¸&quot;">â€‹</a></h3><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»ç»§æ‰¿HttpExceptionï¼Œåœ¨é‡Œé¢è¿›è¡Œä¸€äº›è‡ªå®šä¹‰é…ç½®ï¼Œç„¶åä½¿ç”¨çš„æ—¶å€™ç›´æ¥throw xxxException</p><p>å®˜ç½‘ç»™æˆ‘ä»¬å†…ç½®äº†å¾ˆå¤šHttpExceptionçš„å­ç±»ï¼Œå¯ä»¥ç›´æ¥æŠ›å‡ºã€‚è¯¦è§å®˜ç½‘<a href="https://docs.nestjs.com/exception-filters" target="_blank" rel="noreferrer">https://docs.nestjs.com/exception-filters</a></p><p>å¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">new BadRequestException(&#39;Something bad happened&#39;, { cause: new Error(), description: &#39;Some error description&#39; })</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">new BadRequestException(&#39;Something bad happened&#39;, { cause: new Error(), description: &#39;Some error description&#39; })</span></span></code></pre></div><p>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;message&quot;: &quot;Something bad happened&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;error&quot;: &quot;Some error description&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;statusCode&quot;: 400,</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  &quot;message&quot;: &quot;Something bad happened&quot;,</span></span>
<span class="line"><span style="color:#24292e;">  &quot;error&quot;: &quot;Some error description&quot;,</span></span>
<span class="line"><span style="color:#24292e;">  &quot;statusCode&quot;: 400,</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p><strong>è¿™é‡Œå†æç¤ºä¸€ä¸‹ï¼šå¦‚æœresponseå‚æ•°åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£è¿”å›ä½“å°†ä¼šæŠŠstatusä½œä¸ºstatusCodeå±æ€§çš„å€¼ï¼Œä¼šæŠŠoptionsé‡Œçš„descriptionä½œä¸ºerrorå±æ€§çš„å€¼ï¼Œå¦‚æœresponseå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£è¿”å›ä½“å°±åªæœ‰è¿™ä¸ªå¯¹è±¡é‡Œçš„å±æ€§</strong></p><h3 id="_3-å¼‚å¸¸è¿‡æ»¤å™¨exception-filters" tabindex="-1">3. å¼‚å¸¸è¿‡æ»¤å™¨Exception filters <a class="header-anchor" href="#_3-å¼‚å¸¸è¿‡æ»¤å™¨exception-filters" aria-label="Permalink to &quot;3. å¼‚å¸¸è¿‡æ»¤å™¨Exception filters&quot;">â€‹</a></h3><p>å¦‚æœæƒ³è¦æ›´åŠ ä¸ªæ€§åŒ–çš„å®šåˆ¶Exceptionè¿”å›æ•°æ®æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨Exception filtersï¼Œä¸‹é¢æ˜¯æˆ‘è‡ªå®šä¹‰çš„HttpExceptionFilterï¼Œå®ƒéœ€è¦å®ç°ExceptionFilteræ¥å£ï¼Œå®ç°é‡Œé¢catchæ–¹æ³•ï¼Œå¹¶ä½¿ç”¨@Catch()è£…é¥°å™¨è¿›è¡Œä¿®é¥°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œè¡¨æ˜è¦æ•è·å“ªäº›å¼‚å¸¸.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import {</span></span>
<span class="line"><span style="color:#e1e4e8;">  Catch,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ExceptionFilter,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ArgumentsHost,</span></span>
<span class="line"><span style="color:#e1e4e8;">  HttpException,</span></span>
<span class="line"><span style="color:#e1e4e8;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Request, Response } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Catch(HttpException)</span></span>
<span class="line"><span style="color:#e1e4e8;">export class httpExceptionFilter implements ExceptionFilter {</span></span>
<span class="line"><span style="color:#e1e4e8;">  catch(exception: HttpException, host: ArgumentsHost): any {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // æ‹¿åˆ°ctxå¯¹è±¡</span></span>
<span class="line"><span style="color:#e1e4e8;">    const ctx = host.switchToHttp();</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = ctx.getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;">    const response = ctx.getResponse&lt;Response&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;">    const status = exception.getStatus();</span></span>
<span class="line"><span style="color:#e1e4e8;">    response.status(status).json({</span></span>
<span class="line"><span style="color:#e1e4e8;">      code: status,</span></span>
<span class="line"><span style="color:#e1e4e8;">      success: false,</span></span>
<span class="line"><span style="color:#e1e4e8;">      data: {</span></span>
<span class="line"><span style="color:#e1e4e8;">        requestQuery: request.query,</span></span>
<span class="line"><span style="color:#e1e4e8;">        requestParam: request.params,</span></span>
<span class="line"><span style="color:#e1e4e8;">        requestBody: request.body,</span></span>
<span class="line"><span style="color:#e1e4e8;">      },</span></span>
<span class="line"><span style="color:#e1e4e8;">      time: new Date().getTime(),</span></span>
<span class="line"><span style="color:#e1e4e8;">      url: request.url,</span></span>
<span class="line"><span style="color:#e1e4e8;">    });</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import {</span></span>
<span class="line"><span style="color:#24292e;">  Catch,</span></span>
<span class="line"><span style="color:#24292e;">  ExceptionFilter,</span></span>
<span class="line"><span style="color:#24292e;">  ArgumentsHost,</span></span>
<span class="line"><span style="color:#24292e;">  HttpException,</span></span>
<span class="line"><span style="color:#24292e;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Request, Response } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Catch(HttpException)</span></span>
<span class="line"><span style="color:#24292e;">export class httpExceptionFilter implements ExceptionFilter {</span></span>
<span class="line"><span style="color:#24292e;">  catch(exception: HttpException, host: ArgumentsHost): any {</span></span>
<span class="line"><span style="color:#24292e;">    // æ‹¿åˆ°ctxå¯¹è±¡</span></span>
<span class="line"><span style="color:#24292e;">    const ctx = host.switchToHttp();</span></span>
<span class="line"><span style="color:#24292e;">    const request = ctx.getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#24292e;">    const response = ctx.getResponse&lt;Response&gt;();</span></span>
<span class="line"><span style="color:#24292e;">    const status = exception.getStatus();</span></span>
<span class="line"><span style="color:#24292e;">    response.status(status).json({</span></span>
<span class="line"><span style="color:#24292e;">      code: status,</span></span>
<span class="line"><span style="color:#24292e;">      success: false,</span></span>
<span class="line"><span style="color:#24292e;">      data: {</span></span>
<span class="line"><span style="color:#24292e;">        requestQuery: request.query,</span></span>
<span class="line"><span style="color:#24292e;">        requestParam: request.params,</span></span>
<span class="line"><span style="color:#24292e;">        requestBody: request.body,</span></span>
<span class="line"><span style="color:#24292e;">      },</span></span>
<span class="line"><span style="color:#24292e;">      time: new Date().getTime(),</span></span>
<span class="line"><span style="color:#24292e;">      url: request.url,</span></span>
<span class="line"><span style="color:#24292e;">    });</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>catch()æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­hostå‚æ•°çš„ç±»å‹ä¸ºArgumentHostï¼Œå¯ä»¥é€šè¿‡å®ƒæ‹¿åˆ°Requestå’ŒResponseå¯¹è±¡ï¼Œä»è€Œè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ArgumentHostæ˜¯ä¸€ä¸ªå¾ˆä¸°å¯Œå¾ˆå¤æ‚çš„æ¥å£ï¼Œå¯ä»¥ç®€å•çœ‹ä¸€ä¸‹å®ƒçš„å®šä¹‰ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„è¯·æ±‚åè®®æ‹¿åˆ°ä¸åŒçš„hostï¼Œè¿™ä¸ªä»¥åæœ‰æœºä¼šå†ç ”ç©¶ã€‚æœ‰å…´è¶£çš„å¯ä»¥ç§»æ­¥å®˜ç½‘æŸ¥çœ‹ï¼š<a href="https://docs.nestjs.com/fundamentals/execution-context" target="_blank" rel="noreferrer">https://docs.nestjs.com/fundamentals/execution-context</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/**</span></span>
<span class="line"><span style="color:#e1e4e8;"> * Provides methods for retrieving the arguments being passed to a handler.</span></span>
<span class="line"><span style="color:#e1e4e8;"> * Allows choosing the appropriate execution context (e.g., Http, RPC, or</span></span>
<span class="line"><span style="color:#e1e4e8;"> * WebSockets) to retrieve the arguments from.</span></span>
<span class="line"><span style="color:#e1e4e8;"> *</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @publicApi</span></span>
<span class="line"><span style="color:#e1e4e8;"> */</span></span>
<span class="line"><span style="color:#e1e4e8;">export interface ArgumentsHost {</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Returns the array of arguments being passed to the handler.</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    getArgs&lt;T extends Array&lt;any&gt; = any[]&gt;(): T;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Returns a particular argument by index.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @param index index of argument to retrieve</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    getArgByIndex&lt;T = any&gt;(index: number): T;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Switch context to RPC.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @returns interface with methods to retrieve RPC arguments</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    switchToRpc(): RpcArgumentsHost;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Switch context to HTTP.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @returns interface with methods to retrieve HTTP arguments</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    switchToHttp(): HttpArgumentsHost;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Switch context to WebSockets.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @returns interface with methods to retrieve WebSockets arguments</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    switchToWs(): WsArgumentsHost;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Returns the current execution context type (string)</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    getType&lt;TContext extends string = ContextType&gt;(): TContext;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/**</span></span>
<span class="line"><span style="color:#24292e;"> * Provides methods for retrieving the arguments being passed to a handler.</span></span>
<span class="line"><span style="color:#24292e;"> * Allows choosing the appropriate execution context (e.g., Http, RPC, or</span></span>
<span class="line"><span style="color:#24292e;"> * WebSockets) to retrieve the arguments from.</span></span>
<span class="line"><span style="color:#24292e;"> *</span></span>
<span class="line"><span style="color:#24292e;"> * @publicApi</span></span>
<span class="line"><span style="color:#24292e;"> */</span></span>
<span class="line"><span style="color:#24292e;">export interface ArgumentsHost {</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Returns the array of arguments being passed to the handler.</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    getArgs&lt;T extends Array&lt;any&gt; = any[]&gt;(): T;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Returns a particular argument by index.</span></span>
<span class="line"><span style="color:#24292e;">     * @param index index of argument to retrieve</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    getArgByIndex&lt;T = any&gt;(index: number): T;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Switch context to RPC.</span></span>
<span class="line"><span style="color:#24292e;">     * @returns interface with methods to retrieve RPC arguments</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    switchToRpc(): RpcArgumentsHost;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Switch context to HTTP.</span></span>
<span class="line"><span style="color:#24292e;">     * @returns interface with methods to retrieve HTTP arguments</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    switchToHttp(): HttpArgumentsHost;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Switch context to WebSockets.</span></span>
<span class="line"><span style="color:#24292e;">     * @returns interface with methods to retrieve WebSockets arguments</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    switchToWs(): WsArgumentsHost;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Returns the current execution context type (string)</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    getType&lt;TContext extends string = ContextType&gt;(): TContext;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h3 id="_4-ä½¿ç”¨filters" tabindex="-1">4. ä½¿ç”¨filters <a class="header-anchor" href="#_4-ä½¿ç”¨filters" aria-label="Permalink to &quot;4. ä½¿ç”¨filters&quot;">â€‹</a></h3><h4 id="_1æ–¹æ³•ä½œç”¨åŸŸ" tabindex="-1">â‘ æ–¹æ³•ä½œç”¨åŸŸ <a class="header-anchor" href="#_1æ–¹æ³•ä½œç”¨åŸŸ" aria-label="Permalink to &quot;â‘ æ–¹æ³•ä½œç”¨åŸŸ&quot;">â€‹</a></h4><p>å¯ä»¥ç»‘å®šåˆ°å…·ä½“çš„æ–¹æ³•ä¸Šï¼Œä½¿ç”¨@UseFilters(new HttpExceptionFilter())è£…é¥°å™¨ï¼Œå¯ä»¥ä¼ å¤šä¸ªfilterï¼Œ<strong>äº¦å¯ä»¥ä½¿ç”¨ç±»åä½œä¸ºå‚æ•°ï¼Œåˆ›å»ºå®ä¾‹çš„äº‹å°±äº¤ç»™nestæ¡†æ¶å¸®æˆ‘ä»¬å¤„ç†ï¼Œå°½å¯èƒ½ä½¿ç”¨ç±»ä½œä¸ºå‚æ•°ï¼Œå¯ä»¥å‡å°å†…å­˜å¼€æ”¯ï¼Œå› ä¸ºå…¨å±€å…¬ç”¨ä¸€ä¸ªå®ä¾‹instance</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Post()</span></span>
<span class="line"><span style="color:#e1e4e8;">@UseFilters(HttpExceptionFilter)</span></span>
<span class="line"><span style="color:#e1e4e8;">async create(@Body() createCatDto: CreateCatDto) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  throw new ForbiddenException();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Post()</span></span>
<span class="line"><span style="color:#24292e;">@UseFilters(HttpExceptionFilter)</span></span>
<span class="line"><span style="color:#24292e;">async create(@Body() createCatDto: CreateCatDto) {</span></span>
<span class="line"><span style="color:#24292e;">  throw new ForbiddenException();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h4 id="_2controllerä½œç”¨åŸŸ" tabindex="-1">â‘¡Controllerä½œç”¨åŸŸ <a class="header-anchor" href="#_2controllerä½œç”¨åŸŸ" aria-label="Permalink to &quot;â‘¡Controllerä½œç”¨åŸŸ&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@UseFilters(new HttpExceptionFilter())</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CatsController {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@UseFilters(new HttpExceptionFilter())</span></span>
<span class="line"><span style="color:#24292e;">export class CatsController {}</span></span></code></pre></div><h4 id="_3å…¨å±€ä½œç”¨åŸŸ" tabindex="-1">â‘¢å…¨å±€ä½œç”¨åŸŸ <a class="header-anchor" href="#_3å…¨å±€ä½œç”¨åŸŸ" aria-label="Permalink to &quot;â‘¢å…¨å±€ä½œç”¨åŸŸ&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  const app = await NestFactory.create(AppModule);</span></span>
<span class="line"><span style="color:#e1e4e8;">  app.useGlobalFilters(new HttpExceptionFilter());</span></span>
<span class="line"><span style="color:#e1e4e8;">  await app.listen(3000);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">bootstrap();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#24292e;">  const app = await NestFactory.create(AppModule);</span></span>
<span class="line"><span style="color:#24292e;">  app.useGlobalFilters(new HttpExceptionFilter());</span></span>
<span class="line"><span style="color:#24292e;">  await app.listen(3000);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">bootstrap();</span></span></code></pre></div><p>æˆ‘è¯•éªŒäº†ä¸€ä¸‹ï¼Œå…¨å±€ä½¿ç”¨æ—¶ä¸èƒ½ä½¿ç”¨ç±»ä½œä¸ºuseGlobalFiltersçš„å‚æ•°</p><p>æ³¨æ„ï¼šå½“ä½¿ç”¨å…¨å±€æ¨¡å¼çš„æ—¶å€™ï¼Œå¦‚æœæƒ³ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼Œå¿…é¡»ä½¿ç”¨ç‰¹å®šçš„æ–¹å¼ï¼Œåœ¨ä»»æ„ä¸€ä¸ªæ¨¡å—ä¸‹ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      provide: APP_FILTER,</span></span>
<span class="line"><span style="color:#e1e4e8;">      useClass: HttpExceptionFilter,</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">  ],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      provide: APP_FILTER,</span></span>
<span class="line"><span style="color:#24292e;">      useClass: HttpExceptionFilter,</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">  ],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre></div><p>è¿™è·Ÿåé¢è¦å°†çš„å…¨å±€Guardç±»ä¼¼</p><h3 id="_5-æ•è·æ‰€æœ‰å¼‚å¸¸" tabindex="-1">5. æ•è·æ‰€æœ‰å¼‚å¸¸ <a class="header-anchor" href="#_5-æ•è·æ‰€æœ‰å¼‚å¸¸" aria-label="Permalink to &quot;5. æ•è·æ‰€æœ‰å¼‚å¸¸&quot;">â€‹</a></h3><p>@Catch()çš„å‚æ•°åˆ—è¡¨ä¸ºç©ºæ—¶ä¿®é¥°çš„filterå°±æ˜¯ä¸€ä¸ªèƒ½æ•è·æ‰€æœ‰å¼‚å¸¸çš„filterï¼Œè´´å‡ºå®˜ç½‘çš„ç¤ºä¾‹ä»£ç </p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import {</span></span>
<span class="line"><span style="color:#e1e4e8;">  ExceptionFilter,</span></span>
<span class="line"><span style="color:#e1e4e8;">  Catch,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ArgumentsHost,</span></span>
<span class="line"><span style="color:#e1e4e8;">  HttpException,</span></span>
<span class="line"><span style="color:#e1e4e8;">  HttpStatus,</span></span>
<span class="line"><span style="color:#e1e4e8;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { HttpAdapterHost } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Catch()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AllExceptionsFilter implements ExceptionFilter {</span></span>
<span class="line"><span style="color:#e1e4e8;">  constructor(private readonly httpAdapterHost: HttpAdapterHost) {}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  catch(exception: unknown, host: ArgumentsHost): void {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // In certain situations `httpAdapter` might not be available in the</span></span>
<span class="line"><span style="color:#e1e4e8;">    // constructor method, thus we should resolve it here.</span></span>
<span class="line"><span style="color:#e1e4e8;">    const { httpAdapter } = this.httpAdapterHost;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    const ctx = host.switchToHttp();</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    const httpStatus =</span></span>
<span class="line"><span style="color:#e1e4e8;">      exception instanceof HttpException</span></span>
<span class="line"><span style="color:#e1e4e8;">        ? exception.getStatus()</span></span>
<span class="line"><span style="color:#e1e4e8;">        : HttpStatus.INTERNAL_SERVER_ERROR;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    const responseBody = {</span></span>
<span class="line"><span style="color:#e1e4e8;">      statusCode: httpStatus,</span></span>
<span class="line"><span style="color:#e1e4e8;">      timestamp: new Date().toISOString(),</span></span>
<span class="line"><span style="color:#e1e4e8;">      path: httpAdapter.getRequestUrl(ctx.getRequest()),</span></span>
<span class="line"><span style="color:#e1e4e8;">    };</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    httpAdapter.reply(ctx.getResponse(), responseBody, httpStatus);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import {</span></span>
<span class="line"><span style="color:#24292e;">  ExceptionFilter,</span></span>
<span class="line"><span style="color:#24292e;">  Catch,</span></span>
<span class="line"><span style="color:#24292e;">  ArgumentsHost,</span></span>
<span class="line"><span style="color:#24292e;">  HttpException,</span></span>
<span class="line"><span style="color:#24292e;">  HttpStatus,</span></span>
<span class="line"><span style="color:#24292e;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { HttpAdapterHost } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Catch()</span></span>
<span class="line"><span style="color:#24292e;">export class AllExceptionsFilter implements ExceptionFilter {</span></span>
<span class="line"><span style="color:#24292e;">  constructor(private readonly httpAdapterHost: HttpAdapterHost) {}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  catch(exception: unknown, host: ArgumentsHost): void {</span></span>
<span class="line"><span style="color:#24292e;">    // In certain situations `httpAdapter` might not be available in the</span></span>
<span class="line"><span style="color:#24292e;">    // constructor method, thus we should resolve it here.</span></span>
<span class="line"><span style="color:#24292e;">    const { httpAdapter } = this.httpAdapterHost;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    const ctx = host.switchToHttp();</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    const httpStatus =</span></span>
<span class="line"><span style="color:#24292e;">      exception instanceof HttpException</span></span>
<span class="line"><span style="color:#24292e;">        ? exception.getStatus()</span></span>
<span class="line"><span style="color:#24292e;">        : HttpStatus.INTERNAL_SERVER_ERROR;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    const responseBody = {</span></span>
<span class="line"><span style="color:#24292e;">      statusCode: httpStatus,</span></span>
<span class="line"><span style="color:#24292e;">      timestamp: new Date().toISOString(),</span></span>
<span class="line"><span style="color:#24292e;">      path: httpAdapter.getRequestUrl(ctx.getRequest()),</span></span>
<span class="line"><span style="color:#24292e;">    };</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    httpAdapter.reply(ctx.getResponse(), responseBody, httpStatus);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ç»™æ„é€ å™¨ä¼ å…¥ä¸€ä¸ªhttpAdapterå‚æ•°</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  const app = await NestFactory.create(AppModule);</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  const { httpAdapter } = app.get(HttpAdapterHost);</span></span>
<span class="line"><span style="color:#e1e4e8;">  app.useGlobalFilters(new AllExceptionsFilter(httpAdapter));</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  await app.listen(3000);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">bootstrap();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#24292e;">  const app = await NestFactory.create(AppModule);</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  const { httpAdapter } = app.get(HttpAdapterHost);</span></span>
<span class="line"><span style="color:#24292e;">  app.useGlobalFilters(new AllExceptionsFilter(httpAdapter));</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  await app.listen(3000);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">bootstrap();</span></span></code></pre></div><h3 id="_6-ç»§æ‰¿baseexceptionfilter" tabindex="-1">6.ç»§æ‰¿BaseExceptionFilter <a class="header-anchor" href="#_6-ç»§æ‰¿baseexceptionfilter" aria-label="Permalink to &quot;6.ç»§æ‰¿BaseExceptionFilter&quot;">â€‹</a></h3><p>ç”¨äºä¿®æ”¹é»˜è®¤çš„å†…ç½®å…¨å±€å¼‚å¸¸ï¼Œå¯¹äºè¿™ç§å¼‚å¸¸ç±»ï¼Œå¦‚æœä½œç”¨äºæ–¹æ³•æˆ–è€…Controllerï¼Œåˆ™UseFilters()çš„å‚æ•°åªèƒ½ä½¿ç”¨ç±»ï¼Œè®©nestå¸®æˆ‘ä»¬åšå‰©ä¸‹çš„äº‹</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Catch, ArgumentsHost } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { BaseExceptionFilter } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Catch()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AllExceptionsFilter extends BaseExceptionFilter {</span></span>
<span class="line"><span style="color:#e1e4e8;">  catch(exception: unknown, host: ArgumentsHost) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    //....å¤„ç†ç›¸å…³é€»è¾‘</span></span>
<span class="line"><span style="color:#e1e4e8;">    super.catch(exception, host);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Catch, ArgumentsHost } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { BaseExceptionFilter } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Catch()</span></span>
<span class="line"><span style="color:#24292e;">export class AllExceptionsFilter extends BaseExceptionFilter {</span></span>
<span class="line"><span style="color:#24292e;">  catch(exception: unknown, host: ArgumentsHost) {</span></span>
<span class="line"><span style="color:#24292e;">    //....å¤„ç†ç›¸å…³é€»è¾‘</span></span>
<span class="line"><span style="color:#24292e;">    super.catch(exception, host);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>ç¬¬5ç‚¹å’Œç¬¬6ç‚¹å…¶å®éƒ½æ˜¯å…¨å±€å¼‚å¸¸ï¼Œçœ‹ä½ çš„ä¸šåŠ¡è¿›è¡Œç›¸åº”çš„é€‰æ‹©</p><h2 id="å…­ã€pipes" tabindex="-1">å…­ã€Pipes <a class="header-anchor" href="#å…­ã€pipes" aria-label="Permalink to &quot;å…­ã€Pipes&quot;">â€‹</a></h2><p>A pipe is a class annotated with the @Injectable() decorator, which implements the PipeTransform interface.</p><p>ç®¡é“ä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œä½¿ç”¨è£…é¥°å™¨@Injectable()ï¼Œå¹¶å®ç°æ¥å£PipeTransform</p><p>ç®¡é“æœ‰ä¸¤ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯</p><ul><li>transformationï¼šæ•°æ®è½¬æ¢ï¼Œå¦‚å°†è¯·æ±‚çš„è¾“å…¥æ•°æ®ä»stringè½¬ä¸ºinteger</li><li>validationï¼šå¯¹è¯·æ±‚çš„è¾“å…¥æ•°æ®è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯ä¸é€šè¿‡æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¸€éƒ¨åˆ†å…¶å®æ„Ÿè§‰ä¹Ÿå¯ä»¥è®©å‰å°æ¥åš</li></ul><p>ä»¥ä¸Šä¸¤ç§åœºæ™¯ä¸‹ï¼Œç®¡é“éƒ½æ˜¯å¯¹Controlleræ§åˆ¶å™¨ä¸­çš„handlerå¤„ç†å‡½æ•°çš„å‚æ•°è¿›è¡Œæ“ä½œï¼Œè¿™ä¸ªæ“ä½œå‘ç”Ÿåœ¨handlerå‡½æ•°çœŸæ­£æ‰§è¡Œä¹‹å‰ï¼Œå¦‚æœåœ¨pipesä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œä¼šç›´æ¥è·³åˆ°å¼‚å¸¸å¤„ç†ï¼Œå¹¶è¿”å›å‰ç«¯ï¼ŒControllerä¸‹çš„å¤„ç†å‡½æ•°å‹æ ¹ä¸ä¼šæ‰§è¡Œï¼Œè¿™ä¹Ÿç®—æ˜¯ä¸€ç§åº”ç”¨ä¿æŠ¤æœºåˆ¶ã€‚</p><ul><li>å¦‚æœæ˜¯åšvalidationï¼Œé‚£ä¹ˆè¦ä¹ˆéªŒè¯é€šè¿‡è¿”å›æ²¡æœ‰ç»è¿‡ä¿®æ”¹çš„valueï¼Œè¦ä¹ˆéªŒè¯å¤±è´¥ï¼ŒæŠ›å‡ºé”™è¯¯</li><li>å¦‚æœæ˜¯transformationï¼šé‚£ä¹ˆè½¬æ¢ä¸ºæƒ³è¦çš„ç±»å‹ï¼Œå¦‚æœè½¬æ¢å¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸</li></ul><h3 id="_1-å†…ç½®pipes" tabindex="-1">1. å†…ç½®pipes <a class="header-anchor" href="#_1-å†…ç½®pipes" aria-label="Permalink to &quot;1. å†…ç½®pipes&quot;">â€‹</a></h3><ul><li>ValidationPipe</li><li>ParseIntPipe</li><li>ParseFloatPipe</li><li>ParseBoolPipe</li><li>ParseArrayPipe</li><li>ParseUUIDPipe</li><li>ParseEnumPipe</li><li>DefaultValuePipe</li><li>ParseFilePipe</li></ul><h4 id="parse-pipeç³»åˆ—" tabindex="-1">Parse*Pipeç³»åˆ— <a class="header-anchor" href="#parse-pipeç³»åˆ—" aria-label="Permalink to &quot;Parse*Pipeç³»åˆ—&quot;">â€‹</a></h4><ul><li>ä½¿ç”¨ç±»</li></ul><p>è¿™ä¸€ç³»åˆ—éƒ½æ˜¯è½¬æ¢æ•°æ®ç”¨çš„ï¼Œå¯ä»¥åœ¨Controllerçš„handleræ–¹æ³•å‚æ•°ä¸Šä½¿ç”¨ï¼Œå¦‚ä¸‹ç›´æ¥ç»™@Param()æä¾›ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨äºè½¬æ¢ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªç±»ï¼Œnestä¼šè‡ªåŠ¨å°†å…¶å®åŠ›ä¸ºä¸€ä¸ªå¯¹è±¡</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;hello/:id&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">getHello(@Param(&#39;id&#39;, ParseIntPipe) id: number, @Request() req) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(typeof id);</span></span>
<span class="line"><span style="color:#e1e4e8;">  return req.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;hello/:id&#39;)</span></span>
<span class="line"><span style="color:#24292e;">getHello(@Param(&#39;id&#39;, ParseIntPipe) id: number, @Request() req) {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(typeof id);</span></span>
<span class="line"><span style="color:#24292e;">  return req.user;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>åˆ°è¯·æ±‚ä¸º/hello/123æ—¶æ­£å¸¸è¿”å›</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e9af5dd2dd14461b9e0724958b0cb60~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>å½“è¯·æ±‚ä¸º/hello/123aæ—¶ï¼Œè½¬æ¢å‡ºé”™ï¼ŒæŠ›å‡ºå¼‚å¸¸</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bdc65119443b4ea4895ac3073477b878~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><ul><li>ä½¿ç”¨è‡ªå®šä¹‰çš„å®ä¾‹</li></ul><p>å¦‚ä¸‹è‡ªå®šä¹‰statuscode</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">getHello(</span></span>
<span class="line"><span style="color:#e1e4e8;">    @Param(</span></span>
<span class="line"><span style="color:#e1e4e8;">      &#39;id&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      new ParseIntPipe({</span></span>
<span class="line"><span style="color:#e1e4e8;">        errorHttpStatusCode: HttpStatus.NOT_ACCEPTABLE,</span></span>
<span class="line"><span style="color:#e1e4e8;">      }),</span></span>
<span class="line"><span style="color:#e1e4e8;">    )</span></span>
<span class="line"><span style="color:#e1e4e8;">    id: number,</span></span>
<span class="line"><span style="color:#e1e4e8;">    @Request() req,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(typeof id);</span></span>
<span class="line"><span style="color:#e1e4e8;">    return req.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">getHello(</span></span>
<span class="line"><span style="color:#24292e;">    @Param(</span></span>
<span class="line"><span style="color:#24292e;">      &#39;id&#39;,</span></span>
<span class="line"><span style="color:#24292e;">      new ParseIntPipe({</span></span>
<span class="line"><span style="color:#24292e;">        errorHttpStatusCode: HttpStatus.NOT_ACCEPTABLE,</span></span>
<span class="line"><span style="color:#24292e;">      }),</span></span>
<span class="line"><span style="color:#24292e;">    )</span></span>
<span class="line"><span style="color:#24292e;">    id: number,</span></span>
<span class="line"><span style="color:#24292e;">    @Request() req,</span></span>
<span class="line"><span style="color:#24292e;">  ) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(typeof id);</span></span>
<span class="line"><span style="color:#24292e;">    return req.user;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span></code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01df501b269d44e1b92f2501e686938e~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h3 id="_2-è‡ªå®šä¹‰pipes-validationä¸ºä¾‹" tabindex="-1">2. è‡ªå®šä¹‰Pipes(validationä¸ºä¾‹) <a class="header-anchor" href="#_2-è‡ªå®šä¹‰pipes-validationä¸ºä¾‹" aria-label="Permalink to &quot;2. è‡ªå®šä¹‰Pipes(validationä¸ºä¾‹)&quot;">â€‹</a></h3><p>ä¸è®ºæ˜¯transformationè¿˜æ˜¯validationéƒ½éœ€è¦ä½¿ç”¨@Injectable()è£…é¥°å™¨ï¼Œå¹¶å®ç°PipeTransformæ¥å£ï¼ŒåŸºæœ¬å®ç°å¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { ArgumentMetadata, Injectable, PipeTransform } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CustomValidationPipe implements PipeTransform {</span></span>
<span class="line"><span style="color:#e1e4e8;">  transform(value: any, metadata: ArgumentMetadata): any {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;====custom-pipe-value====&#39;, value);</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;====custom-pipe-metadata====&#39;, metadata);</span></span>
<span class="line"><span style="color:#e1e4e8;">    return value;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { ArgumentMetadata, Injectable, PipeTransform } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class CustomValidationPipe implements PipeTransform {</span></span>
<span class="line"><span style="color:#24292e;">  transform(value: any, metadata: ArgumentMetadata): any {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;====custom-pipe-value====&#39;, value);</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;====custom-pipe-metadata====&#39;, metadata);</span></span>
<span class="line"><span style="color:#24292e;">    return value;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>å…¶ä¸­valueå°±æ˜¯è¢«CustomValidationPipeä¿®é¥°çš„å‚æ•°ï¼Œmetadataæ˜¯è¯¥å‚æ•°çš„metaå±æ€§ï¼Œå®ƒç±»å‹å¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export interface ArgumentMetadata {</span></span>
<span class="line"><span style="color:#e1e4e8;">  type: &#39;body&#39; | &#39;query&#39; | &#39;param&#39; | &#39;custom&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">  metatype?: Type&lt;unknown&gt;;</span></span>
<span class="line"><span style="color:#e1e4e8;">  data?: string;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export interface ArgumentMetadata {</span></span>
<span class="line"><span style="color:#24292e;">  type: &#39;body&#39; | &#39;query&#39; | &#39;param&#39; | &#39;custom&#39;;</span></span>
<span class="line"><span style="color:#24292e;">  metatype?: Type&lt;unknown&gt;;</span></span>
<span class="line"><span style="color:#24292e;">  data?: string;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h5 id="ä½¿ç”¨class-validator" tabindex="-1">ä½¿ç”¨class validator <a class="header-anchor" href="#ä½¿ç”¨class-validator" aria-label="Permalink to &quot;ä½¿ç”¨class validator&quot;">â€‹</a></h5><p>å®˜ç½‘ä¸Šè®²äº†å¥½å‡ ç§ä¸åŒå®ç°ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹class validatorï¼Œä¾æ‰˜äºclass-validatorå’Œclass-transformerï¼Œå…ˆå®‰è£…ä¾èµ–</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$ npm i --save class-validator class-transformer</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$ npm i --save class-validator class-transformer</span></span></code></pre></div><p>å¯¹äºæˆ‘ä»¬æ–°å»ºç”¨æˆ·æ¥è¯´ï¼Œè¦æ ¡éªŒåˆ›å»ºç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¯¹åˆ›å»ºç”¨æˆ·çš„Dtoç±»ä½¿ç”¨class-validatorçš„å„ç§éªŒè¯è£…é¥°å™¨</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { IsOptional, IsString } from &#39;class-validator&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export class CreateUserDto {</span></span>
<span class="line"><span style="color:#e1e4e8;">  @IsString()</span></span>
<span class="line"><span style="color:#e1e4e8;">  username: string;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  @IsString()</span></span>
<span class="line"><span style="color:#e1e4e8;">  password: string;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  @IsString()</span></span>
<span class="line"><span style="color:#e1e4e8;">  @IsOptional()</span></span>
<span class="line"><span style="color:#e1e4e8;">  role?: string;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { IsOptional, IsString } from &#39;class-validator&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export class CreateUserDto {</span></span>
<span class="line"><span style="color:#24292e;">  @IsString()</span></span>
<span class="line"><span style="color:#24292e;">  username: string;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  @IsString()</span></span>
<span class="line"><span style="color:#24292e;">  password: string;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  @IsString()</span></span>
<span class="line"><span style="color:#24292e;">  @IsOptional()</span></span>
<span class="line"><span style="color:#24292e;">  role?: string;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>ç¼–å†™validation-pipesç±»</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import {</span></span>
<span class="line"><span style="color:#e1e4e8;">  ArgumentMetadata,</span></span>
<span class="line"><span style="color:#e1e4e8;">  BadRequestException,</span></span>
<span class="line"><span style="color:#e1e4e8;">  Injectable,</span></span>
<span class="line"><span style="color:#e1e4e8;">  PipeTransform,</span></span>
<span class="line"><span style="color:#e1e4e8;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { validate } from &#39;class-validator&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { plainToInstance } from &#39;class-transformer&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CustomValidationPipe implements PipeTransform&lt;any&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  async transform(value: any, metadata: ArgumentMetadata) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;====custom-pipe-value====&#39;, value);</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;====custom-pipe-metadata====&#39;, metadata);</span></span>
<span class="line"><span style="color:#e1e4e8;">    const { metatype } = metadata;</span></span>
<span class="line"><span style="color:#e1e4e8;">    // åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æœ‰æ²¡æœ‰ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰ç›¸å½“äºæ˜¯åŸç”Ÿçš„jsï¼Œåˆ™ä¸åšæ ¡éªŒ</span></span>
<span class="line"><span style="color:#e1e4e8;">    // è¿™é‡Œçš„ç±»å‹æŒ‡çš„å°±æ˜¯Controllerä¸­çš„å‚æ•°æœ‰æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œåªæœ‰åˆ¶å®šäº†ç±»å‹çš„å‚æ•°æ‰éœ€è¦æ ¡éªŒ</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (!metatype || !this.toValidate(metatype)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      return value;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    // è·å–å¸¦æœ‰ç±»å‹çš„objå¯¹è±¡</span></span>
<span class="line"><span style="color:#e1e4e8;">    const object = plainToInstance(metatype, value);</span></span>
<span class="line"><span style="color:#e1e4e8;">    // æ ¡éªŒ</span></span>
<span class="line"><span style="color:#e1e4e8;">    const errors = await validate(object);</span></span>
<span class="line"><span style="color:#e1e4e8;">    // å¦‚æœæ ¡éªŒå‡ºé”™ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (errors.length &gt; 0) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      throw new BadRequestException(&#39;Validation failed&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    // å¦‚æœæ ¡éªŒé€šè¿‡è¿”å›value unchanged</span></span>
<span class="line"><span style="color:#e1e4e8;">    return value;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  private toValidate(metatype: Function): boolean {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const types: Function[] = [String, Boolean, Number, Array, Object];</span></span>
<span class="line"><span style="color:#e1e4e8;">    return !types.includes(metatype);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import {</span></span>
<span class="line"><span style="color:#24292e;">  ArgumentMetadata,</span></span>
<span class="line"><span style="color:#24292e;">  BadRequestException,</span></span>
<span class="line"><span style="color:#24292e;">  Injectable,</span></span>
<span class="line"><span style="color:#24292e;">  PipeTransform,</span></span>
<span class="line"><span style="color:#24292e;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { validate } from &#39;class-validator&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { plainToInstance } from &#39;class-transformer&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class CustomValidationPipe implements PipeTransform&lt;any&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  async transform(value: any, metadata: ArgumentMetadata) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;====custom-pipe-value====&#39;, value);</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;====custom-pipe-metadata====&#39;, metadata);</span></span>
<span class="line"><span style="color:#24292e;">    const { metatype } = metadata;</span></span>
<span class="line"><span style="color:#24292e;">    // åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æœ‰æ²¡æœ‰ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰ç›¸å½“äºæ˜¯åŸç”Ÿçš„jsï¼Œåˆ™ä¸åšæ ¡éªŒ</span></span>
<span class="line"><span style="color:#24292e;">    // è¿™é‡Œçš„ç±»å‹æŒ‡çš„å°±æ˜¯Controllerä¸­çš„å‚æ•°æœ‰æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œåªæœ‰åˆ¶å®šäº†ç±»å‹çš„å‚æ•°æ‰éœ€è¦æ ¡éªŒ</span></span>
<span class="line"><span style="color:#24292e;">    if (!metatype || !this.toValidate(metatype)) {</span></span>
<span class="line"><span style="color:#24292e;">      return value;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    // è·å–å¸¦æœ‰ç±»å‹çš„objå¯¹è±¡</span></span>
<span class="line"><span style="color:#24292e;">    const object = plainToInstance(metatype, value);</span></span>
<span class="line"><span style="color:#24292e;">    // æ ¡éªŒ</span></span>
<span class="line"><span style="color:#24292e;">    const errors = await validate(object);</span></span>
<span class="line"><span style="color:#24292e;">    // å¦‚æœæ ¡éªŒå‡ºé”™ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="color:#24292e;">    if (errors.length &gt; 0) {</span></span>
<span class="line"><span style="color:#24292e;">      throw new BadRequestException(&#39;Validation failed&#39;);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    // å¦‚æœæ ¡éªŒé€šè¿‡è¿”å›value unchanged</span></span>
<span class="line"><span style="color:#24292e;">    return value;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  private toValidate(metatype: Function): boolean {</span></span>
<span class="line"><span style="color:#24292e;">    const types: Function[] = [String, Boolean, Number, Array, Object];</span></span>
<span class="line"><span style="color:#24292e;">    return !types.includes(metatype);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>ä½¿ç”¨ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Post()</span></span>
<span class="line"><span style="color:#e1e4e8;">  async create(@Body(new CustomValidationPipe()) createUserDto: CreateUserDto) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const newUser = await this.userService.create(createUserDto);</span></span>
<span class="line"><span style="color:#e1e4e8;">    this.logger.log(</span></span>
<span class="line"><span style="color:#e1e4e8;">      `æ–°å»ºç”¨æˆ·æˆåŠŸ,ç”¨æˆ·å[${newUser.username}],è§’è‰²[${newUser.role}]`,</span></span>
<span class="line"><span style="color:#e1e4e8;">    );</span></span>
<span class="line"><span style="color:#e1e4e8;">    return RespBean.success(newUser);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Post()</span></span>
<span class="line"><span style="color:#24292e;">  async create(@Body(new CustomValidationPipe()) createUserDto: CreateUserDto) {</span></span>
<span class="line"><span style="color:#24292e;">    const newUser = await this.userService.create(createUserDto);</span></span>
<span class="line"><span style="color:#24292e;">    this.logger.log(</span></span>
<span class="line"><span style="color:#24292e;">      `æ–°å»ºç”¨æˆ·æˆåŠŸ,ç”¨æˆ·å[${newUser.username}],è§’è‰²[${newUser.role}]`,</span></span>
<span class="line"><span style="color:#24292e;">    );</span></span>
<span class="line"><span style="color:#24292e;">    return RespBean.success(newUser);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span></code></pre></div><p>éªŒè¯å¦‚ä¸‹ï¼Œå°†passwordå†™æˆäº†numberè€Œä¸æ˜¯string</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dcded6dddd6c4ce1a01c636dd0851bfa~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h3 id="_3-å…¨å±€ä½œç”¨åŸŸä¸‹çš„pipes" tabindex="-1">3. å…¨å±€ä½œç”¨åŸŸä¸‹çš„pipes <a class="header-anchor" href="#_3-å…¨å±€ä½œç”¨åŸŸä¸‹çš„pipes" aria-label="Permalink to &quot;3. å…¨å±€ä½œç”¨åŸŸä¸‹çš„pipes&quot;">â€‹</a></h3><p>ä¾ç„¶æ˜¯ä¸¤ç§å½¢å¼</p><ul><li>ä½¿ç”¨useGlobalPipes</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">// å…¨å±€validationPipes</span></span>
<span class="line"><span style="color:#e1e4e8;">  app.useGlobalPipes(new CustomValidationPipe());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">// å…¨å±€validationPipes</span></span>
<span class="line"><span style="color:#24292e;">  app.useGlobalPipes(new CustomValidationPipe());</span></span></code></pre></div><ul><li>ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œåœ¨ä»»æ„ä¸€ä¸ªæ¨¡å—æ³¨å…¥éƒ½å¯ä»¥</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      provide: APP_PIPE,</span></span>
<span class="line"><span style="color:#e1e4e8;">      useClass: CustomValidationPipe,</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">  ],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      provide: APP_PIPE,</span></span>
<span class="line"><span style="color:#24292e;">      useClass: CustomValidationPipe,</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">  ],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre></div><h3 id="_4-å†…ç½®validationpipe" tabindex="-1">4. å†…ç½®validationPipe <a class="header-anchor" href="#_4-å†…ç½®validationpipe" aria-label="Permalink to &quot;4. å†…ç½®validationPipe&quot;">â€‹</a></h3><p>å½“ç„¶è®²äº†è¿™ä¹ˆå¤šï¼Œåªæ˜¯è¯´æ˜äº†åŸç†ï¼Œå…¶å®æˆ‘ä»¬å¤§å¯ä¸å¿…è‡ªå·±å†™ï¼Œç›´æ¥ä½¿ç”¨å†…ç½®çš„å°±è¡Œï¼Œè€Œä¸”æä¾›äº†ä¸°å¯Œçš„é…ç½®è‡ªå®šä¹‰åŠŸèƒ½ï¼Œå…·ä½“è¯¦æƒ…å¯ç§»æ­¥å®˜ç½‘ï¼š<a href="https://docs.nestjs.com/techniques/validation" target="_blank" rel="noreferrer">https://docs.nestjs.com/techniques/validation</a></p><p>åŸºæœ¬ä½¿ç”¨ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { ValidationPipe } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">app.useGlobalPipes(</span></span>
<span class="line"><span style="color:#e1e4e8;">  new ValidationPipe({</span></span>
<span class="line"><span style="color:#e1e4e8;">    disableErrorMessages: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">  }),</span></span>
<span class="line"><span style="color:#e1e4e8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { ValidationPipe } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">app.useGlobalPipes(</span></span>
<span class="line"><span style="color:#24292e;">  new ValidationPipe({</span></span>
<span class="line"><span style="color:#24292e;">    disableErrorMessages: true,</span></span>
<span class="line"><span style="color:#24292e;">  }),</span></span>
<span class="line"><span style="color:#24292e;">);</span></span></code></pre></div><h3 id="_5-transformation-pipesè‡ªå®šä¹‰ä½¿ç”¨åœºæ™¯" tabindex="-1">5. transformation-pipesè‡ªå®šä¹‰ä½¿ç”¨åœºæ™¯ <a class="header-anchor" href="#_5-transformation-pipesè‡ªå®šä¹‰ä½¿ç”¨åœºæ™¯" aria-label="Permalink to &quot;5. transformation-pipesè‡ªå®šä¹‰ä½¿ç”¨åœºæ™¯&quot;">â€‹</a></h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰transformation pipesï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨transformæ–¹æ³•å†…è¿”å›ä¸åŒçš„ç»“æœå°±è¡Œäº†ï¼Œå®ƒä¼šè¦†ç›–ä¹‹å‰çš„valueï¼Œè¿™æ˜¯å¯¹å‰ç«¯ä¼ å€¼çš„å¹²é¢„ï¼Œæœ‰æ—¶å€™ä¹Ÿä¼šå¾ˆæœ‰ç”¨</p><ul><li>æ¯”å¦‚å°†æ•°æ®ç±»å‹è¿›è¡Œè½¬æ¢</li><li>å¯¹éœ€è¦çš„æ•°æ®å¦‚æœæŸä¸ªå±æ€§ä¸å­˜åœ¨é‚£å°±ç»™å®ƒä¸€ä¸ªé»˜è®¤å€¼ï¼Œæ¯”å¦‚åšæŸ¥è¯¢æ“ä½œçš„æ—¶å€™ï¼Œæœ‰äº›æŸ¥è¯¢å‚æ•°æ²¡ä¼ é‚£å°±ä½¿ç”¨é»˜è®¤å€¼</li></ul><p>å®˜ç½‘ç¤ºä¾‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class ParseIntPipe implements PipeTransform&lt;string, number&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  transform(value: string, metadata: ArgumentMetadata): number {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const val = parseInt(value, 10);</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (isNaN(val)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      throw new BadRequestException(&#39;Validation failed&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    return val;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class ParseIntPipe implements PipeTransform&lt;string, number&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  transform(value: string, metadata: ArgumentMetadata): number {</span></span>
<span class="line"><span style="color:#24292e;">    const val = parseInt(value, 10);</span></span>
<span class="line"><span style="color:#24292e;">    if (isNaN(val)) {</span></span>
<span class="line"><span style="color:#24292e;">      throw new BadRequestException(&#39;Validation failed&#39;);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    return val;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>æ³¨æ„è¿™é‡ŒPipeTransform&lt;T, R&gt;æ³›å‹çš„ä½¿ç”¨ï¼ŒTè¡¨ç¤ºè¾“å…¥çš„ç±»å‹ï¼ŒRè¡¨ç¤ºè¿”å›çš„ç±»å‹</p><p>ä½¿ç”¨å’Œä¹‹å‰è®²çš„ä¸€æ ·ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;:id&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">async findOne(@Param(&#39;id&#39;, new ParseIntPipe()) id) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return this.catsService.findOne(id);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;:id&#39;)</span></span>
<span class="line"><span style="color:#24292e;">async findOne(@Param(&#39;id&#39;, new ParseIntPipe()) id) {</span></span>
<span class="line"><span style="color:#24292e;">  return this.catsService.findOne(id);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h3 id="_6-å®ç°idè½¬userå®ä½“çš„transformation-pipe" tabindex="-1">6. å®ç°idè½¬userå®ä½“çš„transformation pipe <a class="header-anchor" href="#_6-å®ç°idè½¬userå®ä½“çš„transformation-pipe" aria-label="Permalink to &quot;6. å®ç°idè½¬userå®ä½“çš„transformation pipe&quot;">â€‹</a></h3><p>è¿™é‡Œå®ç°ä¸€ä¸‹å®˜ç½‘ä¸Šçš„å¦å¤–ä¸€ä¸ªç•™ç»™è¯»è€…çš„ä¾‹å­ï¼Œå°±æ˜¯å‰ç«¯ä¼ å…¥çš„æ˜¯ä¸€ä¸ªuserIdï¼Œæˆ‘ä»¬éœ€è¦åœ¨transformation pipeä¸­æ ¹æ®è¿™ä¸ªidæ¥è¿”å›ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å°†idè½¬æ¢ä¸ºç”¨æˆ·</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { ArgumentMetadata, Injectable, PipeTransform } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { UserService } from &#39;../../modules/user/user.service&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class UserByIdPipe implements PipeTransform&lt;any&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  constructor(private readonly userService: UserService) {}</span></span>
<span class="line"><span style="color:#e1e4e8;">  async transform(value: string, metadata: ArgumentMetadata) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const value1 = parseInt(value, 10);</span></span>
<span class="line"><span style="color:#e1e4e8;">    // è¿™é‡Œä»æ•°æ®åº“æŸ¥æ‰¾userï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯prisma</span></span>
<span class="line"><span style="color:#e1e4e8;">    const user = await this.userService.findOneById(value1);</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (user) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      // å»é™¤å¯†ç </span></span>
<span class="line"><span style="color:#e1e4e8;">      const { password, ...res } = user;</span></span>
<span class="line"><span style="color:#e1e4e8;">      return res;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { ArgumentMetadata, Injectable, PipeTransform } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { UserService } from &#39;../../modules/user/user.service&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class UserByIdPipe implements PipeTransform&lt;any&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  constructor(private readonly userService: UserService) {}</span></span>
<span class="line"><span style="color:#24292e;">  async transform(value: string, metadata: ArgumentMetadata) {</span></span>
<span class="line"><span style="color:#24292e;">    const value1 = parseInt(value, 10);</span></span>
<span class="line"><span style="color:#24292e;">    // è¿™é‡Œä»æ•°æ®åº“æŸ¥æ‰¾userï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯prisma</span></span>
<span class="line"><span style="color:#24292e;">    const user = await this.userService.findOneById(value1);</span></span>
<span class="line"><span style="color:#24292e;">    if (user) {</span></span>
<span class="line"><span style="color:#24292e;">      // å»é™¤å¯†ç </span></span>
<span class="line"><span style="color:#24292e;">      const { password, ...res } = user;</span></span>
<span class="line"><span style="color:#24292e;">      return res;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>ä½¿ç”¨</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;users/:id&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">getUser(@Param(&#39;id&#39;, UserByIdPipe) user: User) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return user;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;users/:id&#39;)</span></span>
<span class="line"><span style="color:#24292e;">getUser(@Param(&#39;id&#39;, UserByIdPipe) user: User) {</span></span>
<span class="line"><span style="color:#24292e;">  return user;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>æµ‹è¯•</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/695b8739bce240d8b338c6a4029b7fff~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h3 id="_7-pipeæä¾›é»˜è®¤å€¼" tabindex="-1">7. pipeæä¾›é»˜è®¤å€¼ <a class="header-anchor" href="#_7-pipeæä¾›é»˜è®¤å€¼" aria-label="Permalink to &quot;7. pipeæä¾›é»˜è®¤å€¼&quot;">â€‹</a></h3><p>ä¸»è¦ç”¨åœ¨å‰ç«¯ä¼ è¿‡æ¥çš„æ•°æ®æ˜¯nullæˆ–è€…undefinedï¼Œå¦‚æœæˆ‘ä»¬ä¸åšå¤„ç†å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä»–ä»¬è½¬æ¢å‰å†åŠ ä¸€å±‚æä¾›é»˜è®¤å€¼çš„ç®¡é“ï¼Œè¾ƒä¸ºç®€å•ï¼Œç›´æ¥å¼•ç”¨å®˜æ–¹çš„ç¤ºä¾‹</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get()</span></span>
<span class="line"><span style="color:#e1e4e8;">async findAll(</span></span>
<span class="line"><span style="color:#e1e4e8;">  @Query(&#39;activeOnly&#39;, new DefaultValuePipe(false), ParseBoolPipe) activeOnly: boolean,</span></span>
<span class="line"><span style="color:#e1e4e8;">  @Query(&#39;page&#39;, new DefaultValuePipe(0), ParseIntPipe) page: number,</span></span>
<span class="line"><span style="color:#e1e4e8;">) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return this.catsService.findAll({ activeOnly, page });</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get()</span></span>
<span class="line"><span style="color:#24292e;">async findAll(</span></span>
<span class="line"><span style="color:#24292e;">  @Query(&#39;activeOnly&#39;, new DefaultValuePipe(false), ParseBoolPipe) activeOnly: boolean,</span></span>
<span class="line"><span style="color:#24292e;">  @Query(&#39;page&#39;, new DefaultValuePipe(0), ParseIntPipe) page: number,</span></span>
<span class="line"><span style="color:#24292e;">) {</span></span>
<span class="line"><span style="color:#24292e;">  return this.catsService.findAll({ activeOnly, page });</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h2 id="ä¸ƒã€guards" tabindex="-1">ä¸ƒã€Guards <a class="header-anchor" href="#ä¸ƒã€guards" aria-label="Permalink to &quot;ä¸ƒã€Guards&quot;">â€‹</a></h2><p>A guard is a class annotated with the @Injectable() decorator, which implements the CanActivate interface.</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd51a71392a74fc08dab8ae87b427011~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>å­—é¢ç†è§£å°±æ˜¯å®ˆå«ï¼Œå®ƒæœ€çªå‡ºçš„ä½œç”¨å°±æ˜¯ç”¨æ¥åšé‰´æƒï¼Œå°±æ˜¯æ¥å†³å®šä¸€ä¸ªè¯·æ±‚æ˜¯å¦è¢«å¤„ç†åŠæ€ä¹ˆå¤„ç†ï¼Œè¿™ä¾èµ–äºä¸€å®šçš„æ¡ä»¶ï¼Œæ¯”å¦‚æƒé™ã€è§’è‰²ç­‰ç­‰ï¼Œå®ƒå’Œç”¨æˆ·æƒé™æŒ‚é’©ã€‚å¯èƒ½æœ‰çš„åŒå¿—å›æƒ³ç”¨ä¸­é—´ä»¶æ¥å¤„ç†ï¼Œä¸­é—´ä»¶å¯¹ä¸€èˆ¬çš„è¦æ±‚è¿˜å¯ä»¥åšåˆ°ï¼Œä½†æ˜¯å¯¹ä¸€äº›å¤æ‚éœ€æ±‚ï¼Œæ¯”å¦‚ä¸åŒæƒé™æ¥ä¸‹å»è¦è¿›è¡Œçš„æ“ä½œæ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸­é—´ä»¶ä»…ä»…é ä¸€ä¸ªnextå‡½æ•°æ˜¯æ²¡æ³•ç²¾ç¡®æ§åˆ¶ä¸‹ä¸€æ­¥å¾€å“ªé‡Œèµ°çš„ã€‚</p><p>Guardsçš„æ‰§è¡Œé¡ºåºåœ¨æ‰€æœ‰çš„ä¸­é—´ä»¶ä¹‹åï¼Œä½†æ˜¯åœ¨ä»»ä½•çš„interceptorå’Œpipeä¹‹å‰</p><h3 id="_1-åŸºæœ¬ç¤ºä¾‹ä»£ç " tabindex="-1">1. åŸºæœ¬ç¤ºä¾‹ä»£ç  <a class="header-anchor" href="#_1-åŸºæœ¬ç¤ºä¾‹ä»£ç " aria-label="Permalink to &quot;1. åŸºæœ¬ç¤ºä¾‹ä»£ç &quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Injectable, CanActivate, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Observable } from &#39;rxjs&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AuthGuard implements CanActivate {</span></span>
<span class="line"><span style="color:#e1e4e8;">  canActivate(</span></span>
<span class="line"><span style="color:#e1e4e8;">    context: ExecutionContext,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ): boolean | Promise&lt;boolean&gt; | Observable&lt;boolean&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = context.switchToHttp().getRequest();</span></span>
<span class="line"><span style="color:#e1e4e8;">    return validateRequest(request);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Injectable, CanActivate, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Observable } from &#39;rxjs&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class AuthGuard implements CanActivate {</span></span>
<span class="line"><span style="color:#24292e;">  canActivate(</span></span>
<span class="line"><span style="color:#24292e;">    context: ExecutionContext,</span></span>
<span class="line"><span style="color:#24292e;">  ): boolean | Promise&lt;boolean&gt; | Observable&lt;boolean&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    const request = context.switchToHttp().getRequest();</span></span>
<span class="line"><span style="color:#24292e;">    return validateRequest(request);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><ul><li>ä½¿ç”¨@Injectableè£…é¥°å™¨ï¼Œå®ç°CanActivateæ¥å£</li><li>canActivateæ–¹æ³•ï¼Œé‡ç‚¹å…³æ³¨contextæ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæ¯”è¾ƒå¼ºå¤§ã€‚</li><li>æ–¹æ³•è¿”å›trueç»§ç»­æ‰§è¡Œï¼Œè¿”å›falseæ‹’ç»è¯¥æ¬¡è¯·æ±‚</li></ul><h3 id="_2-execution-context" tabindex="-1">2. Execution context <a class="header-anchor" href="#_2-execution-context" aria-label="Permalink to &quot;2. Execution context&quot;">â€‹</a></h3><p>ç»§æ‰¿è‡ªArgumentHostï¼Œè¯¦æƒ…è§å®˜ç½‘ï¼š<a href="https://docs.nestjs.com/fundamentals/execution-context" target="_blank" rel="noreferrer">https://docs.nestjs.com/fundamentals/execution-context</a></p><p>Nestæä¾›äº†å¾ˆå¤šå®ç”¨çš„å·¥å…·ç±»æ¥å¸®æˆ‘ä»¬æ›´è½»æ¾çš„ç¼–å†™åº”ç”¨ï¼ŒExecution contextå°±æ˜¯å…¶ä¸€ï¼Œåé¢å•ç‹¬å¼€ä¸€ç¯‡æ¥å°†ArgumentsHostå’ŒExecutionContextã€‚</p><h3 id="_3-åŸºäºroleçš„æƒé™è®¤è¯" tabindex="-1">3.åŸºäºRoleçš„æƒé™è®¤è¯ <a class="header-anchor" href="#_3-åŸºäºroleçš„æƒé™è®¤è¯" aria-label="Permalink to &quot;3.åŸºäºRoleçš„æƒé™è®¤è¯&quot;">â€‹</a></h3><p>è¿™é‡Œä¸»è¦è®²ä¸€ä¸ªä¸œè¥¿å°±æ˜¯@SetMetadataçš„ä½¿ç”¨ï¼Œè¿™æ˜¯ç”¨æ¥æ·»åŠ å…ƒæ•°æ®çš„ï¼Œæˆ‘ä»¬æƒ³å®ç°çš„åŠŸèƒ½å¤§æ¦‚å¦‚ä¸‹ï¼š</p><p>åœ¨Controlleræˆ–method-handlerä¸ŠåŠ ä¸€ä¸ªç±»ä¼¼Roles(&#39;admin&#39;)è£…é¥°å™¨ï¼Œè®©åªå…·æœ‰adminè§’è‰²çš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®å’Œè°ƒç”¨ï¼Œå¦‚ä¸‹è¡¨ç¤ºåªæœ‰adminæƒé™çš„ç”¨æˆ·æ‰æœ‰èµ„æ ¼è®¿é—®ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Post()</span></span>
<span class="line"><span style="color:#e1e4e8;">@Roles(&#39;admin&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">async create(@Body() createCatDto: CreateCatDto) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.catsService.create(createCatDto);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Post()</span></span>
<span class="line"><span style="color:#24292e;">@Roles(&#39;admin&#39;)</span></span>
<span class="line"><span style="color:#24292e;">async create(@Body() createCatDto: CreateCatDto) {</span></span>
<span class="line"><span style="color:#24292e;">  this.catsService.create(createCatDto);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢?å…ˆæ¥ä¸ªæ€è·¯åˆ†æ</p><p>æˆ‘ä»¬åœ¨canActivateæ–¹æ³•ä¸­éœ€è¦åšä¸€ä¸‹å‡ ä¸ªäº‹æƒ…ï¼š</p><ul><li>ä¸€æ˜¯è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„roleè§’è‰²ä¿¡æ¯ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡contexæ‹¿åˆ°requestï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šåœ¨è®¤è¯é‚£ä¸€æ­¥å°±å°†userä¿¡æ¯é™„åŠ åˆ°requestä¸Šï¼Œè¿™æ ·æˆ‘ä»¬ç›´æ¥é€šè¿‡request.userå³å¯æ‹¿åˆ°userä¿¡æ¯ï¼Œè¯¦è§æˆ‘çš„ç³»åˆ—ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦å°±æ˜¯å°†ç”¨æˆ·è®¤è¯çš„<a href="https://juejin.cn/post/7171424088827625479" target="_blank" rel="noreferrer">https://juejin.cn/post/7171424088827625479</a></li><li>äºŒæ˜¯è¦è·å–åˆ°@Roles()è£…é¥°å™¨çš„å‚æ•°ä¿¡æ¯ï¼Œå³æ ‡ç¤ºäº†å“ªäº›ç”¨æˆ·è§’è‰²å¯ä»¥è®¿é—®ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°ä¸¤ä¸ªä¸œè¥¿ï¼šâ‘ Rolesè£…é¥°å™¨éœ€è¦è‡ªå®šä¹‰ï¼Œé€šè¿‡å¯¹@SetMetadataè¿›è¡Œä¸€å±‚åŒ…è£¹ï¼Œå¯¹æ‰€è£…é¥°çš„Controlleræˆ–methodæ·»åŠ å…ƒæ•°æ®ï¼›â‘¡Nestæ¡†æ¶ç»™æˆ‘ä»¬æä¾›çš„åå°„ç±»ï¼Œé€šè¿‡åå°„ç±»æ‹¿åˆ°è£…é¥°å™¨å†…çš„å‚æ•°</li></ul><p>å…·ä½“åšæ³•å¦‚ä¸‹ï¼š</p><p>è‡ªå®šä¹‰@Rolesè£…é¥°å™¨</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { SetMetadata } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export const Roles = (...roles: string[]) =&gt; SetMetadata(&#39;roles&#39;, roles);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { SetMetadata } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export const Roles = (...roles: string[]) =&gt; SetMetadata(&#39;roles&#39;, roles);</span></span></code></pre></div><p>æ„é€ ä¸€ä¸ªGuard</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Injectable, CanActivate, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Reflector } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class RolesGuard implements CanActivate {</span></span>
<span class="line"><span style="color:#e1e4e8;">  constructor(private reflector: Reflector) {}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  canActivate(context: ExecutionContext): boolean {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // é€šè¿‡åå°„æ‹¿åˆ°ï¼Œcontext.getHandler()æ‹¿åˆ°çš„æ˜¯è£…é¥°çš„é‚£ä¸ªroute handler</span></span>
<span class="line"><span style="color:#e1e4e8;">    // è€Œrolesä¿¡æ¯å°±æ”¾åœ¨Controllerçš„å…ƒæ•°æ®å¯¹è±¡ä¸Š</span></span>
<span class="line"><span style="color:#e1e4e8;">    const roles = this.reflector.get&lt;string[]&gt;(&#39;roles&#39;, context.getHandler());</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (!roles) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      return true;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = context.switchToHttp().getRequest();</span></span>
<span class="line"><span style="color:#e1e4e8;">    // useråœ¨è¿™é‡Œè·å–ï¼Œå…¶å®åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™ä¼šæŠŠç”¨æˆ·ä¿¡æ¯éƒ½è—åˆ°tokené‡Œï¼Œæ¯æ¬¡ç”¨æˆ·ç™»å½•æºå¸¦token</span></span>
<span class="line"><span style="color:#e1e4e8;">    // åº”ç”¨åœ¨è®¤è¯tokençš„åŒæ—¶å°±æŠŠç”¨æˆ·userä¿¡æ¯é™„åŠ åˆ°requestä¸­äº†ï¼Œè®¤è¯åœ¨è¿™ä¹‹å‰æ‰€ä»¥è¿™é‡Œå¯ä»¥æ‹¿åˆ°</span></span>
<span class="line"><span style="color:#e1e4e8;">    const user = request.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">    return matchRoles(roles, user.roles);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Injectable, CanActivate, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Reflector } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class RolesGuard implements CanActivate {</span></span>
<span class="line"><span style="color:#24292e;">  constructor(private reflector: Reflector) {}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  canActivate(context: ExecutionContext): boolean {</span></span>
<span class="line"><span style="color:#24292e;">    // é€šè¿‡åå°„æ‹¿åˆ°ï¼Œcontext.getHandler()æ‹¿åˆ°çš„æ˜¯è£…é¥°çš„é‚£ä¸ªroute handler</span></span>
<span class="line"><span style="color:#24292e;">    // è€Œrolesä¿¡æ¯å°±æ”¾åœ¨Controllerçš„å…ƒæ•°æ®å¯¹è±¡ä¸Š</span></span>
<span class="line"><span style="color:#24292e;">    const roles = this.reflector.get&lt;string[]&gt;(&#39;roles&#39;, context.getHandler());</span></span>
<span class="line"><span style="color:#24292e;">    if (!roles) {</span></span>
<span class="line"><span style="color:#24292e;">      return true;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    const request = context.switchToHttp().getRequest();</span></span>
<span class="line"><span style="color:#24292e;">    // useråœ¨è¿™é‡Œè·å–ï¼Œå…¶å®åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™ä¼šæŠŠç”¨æˆ·ä¿¡æ¯éƒ½è—åˆ°tokené‡Œï¼Œæ¯æ¬¡ç”¨æˆ·ç™»å½•æºå¸¦token</span></span>
<span class="line"><span style="color:#24292e;">    // åº”ç”¨åœ¨è®¤è¯tokençš„åŒæ—¶å°±æŠŠç”¨æˆ·userä¿¡æ¯é™„åŠ åˆ°requestä¸­äº†ï¼Œè®¤è¯åœ¨è¿™ä¹‹å‰æ‰€ä»¥è¿™é‡Œå¯ä»¥æ‹¿åˆ°</span></span>
<span class="line"><span style="color:#24292e;">    const user = request.user;</span></span>
<span class="line"><span style="color:#24292e;">    return matchRoles(roles, user.roles);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>å¯¹äºé‰´æƒåçš„ä¸€äº›æ“ä½œï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘éœ€è¦è¿›è¡Œå®šåˆ¶ï¼Œè‡³æ­¤ï¼ŒGuardåŸºæœ¬ä¹Ÿè®²å®Œäº†ã€‚</p><h2 id="å…«ã€interceptors" tabindex="-1">å…«ã€Interceptors <a class="header-anchor" href="#å…«ã€interceptors" aria-label="Permalink to &quot;å…«ã€Interceptors&quot;">â€‹</a></h2><p>An interceptor is a class annotated with the @Injectable() decorator and implements the NestInterceptor interface.</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6e1e9ce0fad4132abc21760b1bd3cef~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>æ‹¦æˆªå™¨ï¼é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå…·æœ‰ä»¥ä¸‹èƒ½åŠ›ï¼š</p><ul><li>åœ¨æŸä¸ªæ–¹æ³•æ‰§è¡Œå‰åå¢åŠ é¢å¤–é€»è¾‘</li><li>ä¿®æ”¹ä¸€ä¸ªæ–¹æ³•è¿”å›çš„ç»“æœ</li><li>ä¿®æ”¹ä¸€ä¸ªæ–¹æ³•æŠ›å‡ºçš„é”™è¯¯</li><li>æ‰©å±•ä¸€ä¸ªæ–¹æ³•çš„åŠŸèƒ½</li><li>æ ¹æ®æŸäº›ç‰¹åˆ«çš„æ¡ä»¶ï¼Œé‡å†™ä¸€ä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚ä¸ºäº†ç¼“å­˜ç›®çš„</li></ul><h3 id="_1-å®ç°æ¥å£åŠæ–¹æ³•å‚æ•°è§£æ" tabindex="-1">1. å®ç°æ¥å£åŠæ–¹æ³•å‚æ•°è§£æ <a class="header-anchor" href="#_1-å®ç°æ¥å£åŠæ–¹æ³•å‚æ•°è§£æ" aria-label="Permalink to &quot;1. å®ç°æ¥å£åŠæ–¹æ³•å‚æ•°è§£æ&quot;">â€‹</a></h3><p>æ¯ä¸€ä¸ªæ‹¦æˆªå™¨éƒ½éœ€è¦å®ç°ä¸€ä¸ªNestInterceptoræ¥å£ï¼Œå®ç°é‡Œé¢çš„interceptæ–¹æ³•ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/**</span></span>
<span class="line"><span style="color:#e1e4e8;"> * Interface describing implementation of an interceptor.</span></span>
<span class="line"><span style="color:#e1e4e8;"> *</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @see [Interceptors](https://docs.nestjs.com/interceptors)</span></span>
<span class="line"><span style="color:#e1e4e8;"> *</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @publicApi</span></span>
<span class="line"><span style="color:#e1e4e8;"> */</span></span>
<span class="line"><span style="color:#e1e4e8;">export interface NestInterceptor&lt;T = any, R = any&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Method to implement a custom interceptor.</span></span>
<span class="line"><span style="color:#e1e4e8;">     *</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @param context an `ExecutionContext` object providing methods to access the</span></span>
<span class="line"><span style="color:#e1e4e8;">     * route handler and class about to be invoked.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @param next a reference to the `CallHandler`, which provides access to an</span></span>
<span class="line"><span style="color:#e1e4e8;">     * `Observable` representing the response stream from the route handler.</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    intercept(context: ExecutionContext, next: CallHandler&lt;T&gt;): Observable&lt;R&gt; | Promise&lt;Observable&lt;R&gt;&gt;;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/**</span></span>
<span class="line"><span style="color:#24292e;"> * Interface describing implementation of an interceptor.</span></span>
<span class="line"><span style="color:#24292e;"> *</span></span>
<span class="line"><span style="color:#24292e;"> * @see [Interceptors](https://docs.nestjs.com/interceptors)</span></span>
<span class="line"><span style="color:#24292e;"> *</span></span>
<span class="line"><span style="color:#24292e;"> * @publicApi</span></span>
<span class="line"><span style="color:#24292e;"> */</span></span>
<span class="line"><span style="color:#24292e;">export interface NestInterceptor&lt;T = any, R = any&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Method to implement a custom interceptor.</span></span>
<span class="line"><span style="color:#24292e;">     *</span></span>
<span class="line"><span style="color:#24292e;">     * @param context an `ExecutionContext` object providing methods to access the</span></span>
<span class="line"><span style="color:#24292e;">     * route handler and class about to be invoked.</span></span>
<span class="line"><span style="color:#24292e;">     * @param next a reference to the `CallHandler`, which provides access to an</span></span>
<span class="line"><span style="color:#24292e;">     * `Observable` representing the response stream from the route handler.</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    intercept(context: ExecutionContext, next: CallHandler&lt;T&gt;): Observable&lt;R&gt; | Promise&lt;Observable&lt;R&gt;&gt;;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>ä¸»è¦çœ‹éœ€è¦å®ç°çš„interceptæ–¹æ³•ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°contextå’Œnext</p><h4 id="_1executioncontext" tabindex="-1">â‘ ExecutionContext <a class="header-anchor" href="#_1executioncontext" aria-label="Permalink to &quot;â‘ ExecutionContext&quot;">â€‹</a></h4><p>ç»§æ‰¿è‡ªArgumentsHostï¼Œå¯ä»¥è·å–æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæœ‰è‡ªå·±çš„æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡åå°„æœºåˆ¶ä½¿ç”¨getClass()å’ŒgetHandler()æ‹¿åˆ°classå’Œmethodï¼Œè¯¦æƒ…</p><h4 id="_2callhandler" tabindex="-1">â‘¡CallHandler <a class="header-anchor" href="#_2callhandler" aria-label="Permalink to &quot;â‘¡CallHandler&quot;">â€‹</a></h4><p>CallHandleræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ç°äº†handleæ–¹æ³•ï¼Œæ¥å£å¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/**</span></span>
<span class="line"><span style="color:#e1e4e8;"> * Interface providing access to the response stream.</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @see [Interceptors](https://docs.nestjs.com/interceptors)</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @publicApi</span></span>
<span class="line"><span style="color:#e1e4e8;"> */</span></span>
<span class="line"><span style="color:#e1e4e8;">export interface CallHandler&lt;T = any&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Returns an `Observable` representing the response stream from the route</span></span>
<span class="line"><span style="color:#e1e4e8;">     * handler.</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    handle(): Observable&lt;T&gt;;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/**</span></span>
<span class="line"><span style="color:#24292e;"> * Interface providing access to the response stream.</span></span>
<span class="line"><span style="color:#24292e;"> * @see [Interceptors](https://docs.nestjs.com/interceptors)</span></span>
<span class="line"><span style="color:#24292e;"> * @publicApi</span></span>
<span class="line"><span style="color:#24292e;"> */</span></span>
<span class="line"><span style="color:#24292e;">export interface CallHandler&lt;T = any&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Returns an `Observable` representing the response stream from the route</span></span>
<span class="line"><span style="color:#24292e;">     * handler.</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    handle(): Observable&lt;T&gt;;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ¥å£æä¾›äº†è®¿é—®Responseæµçš„èƒ½åŠ›ï¼Œhandle()å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯responseæµï¼Œç±»å‹æ˜¯ä¸€ä¸ª<code>Observable&lt;T&gt;</code>ç±»å‹ï¼ˆObservableè¿™æ˜¯rxjsçš„å†…å®¹äº†ï¼Œåé¢æœ‰æœºä¼šå•ç‹¬å¼€ä¸€ä¸ªrxjsçš„ç³»åˆ—ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åº“ï¼Œåœ¨å¸®æˆ‘ä»¬å¤„ç†å¼‚æ­¥äº‹ä»¶çš„æ—¶å€™ç”¨å¤„å¾ˆå¤§ï¼Œæœ‰å…´è¶£çš„å¯ç§»æ­¥å®˜ç½‘æå‰å­¦ä¹ ï¼š<a href="https://rxjs.dev/guide/overview" target="_blank" rel="noreferrer">https://rxjs.dev/guide/overview</a>ï¼‰ï¼Œä½ å¯ä»¥åœ¨åˆé€‚çš„ä½ç½®ä½¿ç”¨å®ƒæ¥è°ƒç”¨ä½ çš„route handlerï¼Œå¦‚æœåœ¨intercept()æ–¹æ³•çš„å®ç°ä¸­æ²¡æœ‰è°ƒç”¨è¿‡handle()æ–¹æ³•ï¼Œé‚£ä¹ˆroute handlerå°†ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><p><strong>è°ƒç”¨handle()æ–¹æ³•å‰çš„å¤„ç†é€»è¾‘ç›¸å½“ä¸åœ¨route handlerä¹‹å‰æ·»åŠ çš„é€»è¾‘ï¼Œåœ¨handle()æ–¹æ³•æ‰§è¡Œåçš„é€»è¾‘ç›¸å½“äºåœ¨route handlerä¹‹åæ·»åŠ çš„é€»è¾‘ï¼Œå®ç°äº†å¯¹route handlerçš„æ‹¦æˆªã€‚</strong></p><h3 id="_2-ç®€å•ç¤ºä¾‹" tabindex="-1">2. ç®€å•ç¤ºä¾‹ <a class="header-anchor" href="#_2-ç®€å•ç¤ºä¾‹" aria-label="Permalink to &quot;2. ç®€å•ç¤ºä¾‹&quot;">â€‹</a></h3><p>æˆ‘ä»¬åšä¸€ä¸ªæ—¥å¿—ç›¸å…³çš„æ‹¦æˆªå™¨ï¼Œå®ç°çš„ç›®çš„æ˜¯route handlerå¤„ç†å‰è®°å½•æ—¶é—´å¹¶æ‰“å°ä¸€æ®µæç¤ºä¿¡æ¯ï¼Œå¤„ç†ä¹‹åæ‰“å°å¦ä¸€æ®µæç¤ºä¿¡æ¯å¹¶è®°å½•route handlerçš„æ‰§è¡Œæ—¶é•¿</p><h4 id="æ„å»ºæ‹¦æˆªå™¨" tabindex="-1">æ„å»ºæ‹¦æˆªå™¨ <a class="header-anchor" href="#æ„å»ºæ‹¦æˆªå™¨" aria-label="Permalink to &quot;æ„å»ºæ‹¦æˆªå™¨&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class LoggingInterceptor implements NestInterceptor {</span></span>
<span class="line"><span style="color:#e1e4e8;">  intercept(</span></span>
<span class="line"><span style="color:#e1e4e8;">    context: ExecutionContext,</span></span>
<span class="line"><span style="color:#e1e4e8;">    next: CallHandler&lt;any&gt;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ): Observable&lt;any&gt; | Promise&lt;Observable&lt;any&gt;&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // å¤„ç†route handlerå‰çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;Before...&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    const now = Date.now();</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    return next</span></span>
<span class="line"><span style="color:#e1e4e8;">      .handle().pipe(</span></span>
<span class="line"><span style="color:#e1e4e8;">        tap((value) =&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">          console.log(`After...${Date.now() - now}ms, return value: ${value}`),</span></span>
<span class="line"><span style="color:#e1e4e8;">        ),</span></span>
<span class="line"><span style="color:#e1e4e8;">      );</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class LoggingInterceptor implements NestInterceptor {</span></span>
<span class="line"><span style="color:#24292e;">  intercept(</span></span>
<span class="line"><span style="color:#24292e;">    context: ExecutionContext,</span></span>
<span class="line"><span style="color:#24292e;">    next: CallHandler&lt;any&gt;,</span></span>
<span class="line"><span style="color:#24292e;">  ): Observable&lt;any&gt; | Promise&lt;Observable&lt;any&gt;&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    // å¤„ç†route handlerå‰çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;Before...&#39;);</span></span>
<span class="line"><span style="color:#24292e;">    const now = Date.now();</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    return next</span></span>
<span class="line"><span style="color:#24292e;">      .handle().pipe(</span></span>
<span class="line"><span style="color:#24292e;">        tap((value) =&gt;</span></span>
<span class="line"><span style="color:#24292e;">          console.log(`After...${Date.now() - now}ms, return value: ${value}`),</span></span>
<span class="line"><span style="color:#24292e;">        ),</span></span>
<span class="line"><span style="color:#24292e;">      );</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h4 id="ç»‘å®šæ‹¦æˆªå™¨" tabindex="-1">ç»‘å®šæ‹¦æˆªå™¨ <a class="header-anchor" href="#ç»‘å®šæ‹¦æˆªå™¨" aria-label="Permalink to &quot;ç»‘å®šæ‹¦æˆªå™¨&quot;">â€‹</a></h4><p>å’Œpipeså’Œguardsä¸€æ ·ï¼Œå¯ä»¥ç»‘å®šåˆ°Controllerå±‚ã€methodå±‚ä»¥åŠå…¨å±€ä½œç”¨åŸŸï¼Œä¸‹é¢ç»‘å®šåˆ°methodå±‚é¢ï¼Œä½¿ç”¨@UseInterceptorsæ‹¦æˆªå™¨</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@UseInterceptors(LoggingInterceptor)</span></span>
<span class="line"><span style="color:#e1e4e8;">  @Get(&#39;interceptor/test&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">  testInterceptor() {</span></span>
<span class="line"><span style="color:#e1e4e8;">    return &#39;hello interceptor&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@UseInterceptors(LoggingInterceptor)</span></span>
<span class="line"><span style="color:#24292e;">  @Get(&#39;interceptor/test&#39;)</span></span>
<span class="line"><span style="color:#24292e;">  testInterceptor() {</span></span>
<span class="line"><span style="color:#24292e;">    return &#39;hello interceptor&#39;;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>æµ‹è¯•ç»“æœ</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0fd4e37dbe8d46f392991b68006c7279~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p><strong>å¦‚æœè¦ç»‘å®šå…¨å±€ä½œç”¨åŸŸï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹å¼</strong></p><ul><li>useGlobalInterceptors</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">app.useGlobalInterceptors(new LoggingInterceptor());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">app.useGlobalInterceptors(new LoggingInterceptor());</span></span></code></pre></div><ul><li>ä¾èµ–æ³¨å…¥æ–¹å¼</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      provide: APP_INTERCEPTOR,</span></span>
<span class="line"><span style="color:#e1e4e8;">      useClass: LoggingInterceptor,</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">  ],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      provide: APP_INTERCEPTOR,</span></span>
<span class="line"><span style="color:#24292e;">      useClass: LoggingInterceptor,</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">  ],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre></div><p><strong>å…¶å®æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸€ä¸‹å…³äºç»‘å®šçš„æ–¹å¼ï¼Œæˆ‘å°†åœ¨æ ¸å¿ƒæ¦‚å¿µçš„æœ€åä¸€ç¯‡è¿›è¡Œä¸€ä¸ªæ¢³ç†ï¼Œå¯¹æ‰€æœ‰æ¶‰åŠåˆ°çš„ä½¿ç”¨æ–¹å¼åšä¸€ä¸ªæ€»ç»“ï¼Œå…¶å®æˆ‘ä¸ªäººæ¯”è¾ƒæ¨èç»Ÿä¸€éƒ½ä½¿ç”¨æ³¨å…¥çš„æ–¹å¼ã€‚</strong></p><h3 id="_3-responseç»“æœè½¬æ¢" tabindex="-1">3. responseç»“æœè½¬æ¢ <a class="header-anchor" href="#_3-responseç»“æœè½¬æ¢" aria-label="Permalink to &quot;3. responseç»“æœè½¬æ¢&quot;">â€‹</a></h3><p>ç”±ä¸Šé¢å¯çŸ¥ï¼Œæˆ‘ä»¬é€šè¿‡handle()æ–¹æ³•æ‹¿åˆ°äº†å“åº”æµçš„Observableå¯¹è±¡ï¼Œè¿›è€Œå¯ä»¥å¯¹ç»“æœè¿›è¡Œå„ç§ä¿®æ”¹è½¬æ¢æ“ä½œã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼šå½“route handlerä¸­æ¥æ”¶ @Resè£…é¥°å™¨è£…é¥°çš„å‚æ•°æ—¶ä¸èƒ½ä½¿ç”¨ã€‚ç»è¿‡æˆ‘çš„æµ‹è¯•ï¼Œå‘ç°è¿™ä¹ˆåšä¼šé˜»å¡æ•´ä¸ªè¯·æ±‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa868fe9ed064b44bf615c4775e3db01~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>åšæ•°æ®è½¬æ¢çš„æ‹¦æˆªå™¨å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨pipeç®¡é“ä¸­è¿›è¡Œmapæ“ä½œå°±è¡Œï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹çš„ç¤ºä¾‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export interface Response&lt;T&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  data: T;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class TransformInterceptor&lt;T&gt; implements NestInterceptor&lt;T, Response&lt;T&gt;&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  intercept(context: ExecutionContext, next: CallHandler): Observable&lt;Response&lt;T&gt;&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    return next.handle().pipe(map(data =&gt; ({ data })));</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export interface Response&lt;T&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  data: T;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class TransformInterceptor&lt;T&gt; implements NestInterceptor&lt;T, Response&lt;T&gt;&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  intercept(context: ExecutionContext, next: CallHandler): Observable&lt;Response&lt;T&gt;&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    return next.handle().pipe(map(data =&gt; ({ data })));</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>æç¤ºä¸€ä¸‹ï¼Œinterceptæ–¹æ³•ä¾ç„¶å¯ä»¥æ˜¯åŒæ­¥ä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥</p><p>mapæ“ä½œå¯ä»¥åšä»»æ„è½¬æ¢ï¼Œå¦‚ï¼š</p><ul><li>å°†å€¼è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡</li><li>å°†nullå€¼è½¬æ¢é»˜è®¤çš„ç©ºå­—ç¬¦ä¸²</li><li>å¯¹Exceptionçš„è½¬æ¢</li></ul><p>å…·ä½“çš„å°±ä¸åšæ¼”ç¤ºäº†ï¼Œè¿™ä¸ªå¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œå’Œjsä¸­çš„mapé«˜é˜¶å‡½æ•°ä¸€ä¸ªé“ç†</p><h3 id="_4-ç»“æœè¦†ç›–" tabindex="-1">4. ç»“æœè¦†ç›– <a class="header-anchor" href="#_4-ç»“æœè¦†ç›–" aria-label="Permalink to &quot;4. ç»“æœè¦†ç›–&quot;">â€‹</a></h3><p>è¯´ç™½äº†å°±æ˜¯æŸäº›æƒ…å†µæˆ‘ä»¬ä¸åœ¨è°ƒç”¨handleå¤„ç†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¯èƒ½æœ‰æ—¶å€™æ˜¯å¤šä½™çš„ï¼Œæ¯”å¦‚ç»“æœå·²ç»åœ¨ç¼“å­˜ä¸­æœ‰ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ç¼“å­˜ä¸­æå–å°±å¥½äº†ï¼Œä¸ç”¨åšé‡å¤çš„å¤„ç†ï¼Œè¿™å¯ä»¥å¤§å¤§æå‡æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚ä¼ªä»£ç é€»è¾‘å¤§æ¦‚å¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">const isCached = true;</span></span>
<span class="line"><span style="color:#e1e4e8;">if (isCached) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return of(ç¼“å­˜ä¸­çš„æ•°æ®);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">return next.handle();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">const isCached = true;</span></span>
<span class="line"><span style="color:#24292e;">if (isCached) {</span></span>
<span class="line"><span style="color:#24292e;">  return of(ç¼“å­˜ä¸­çš„æ•°æ®);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">return next.handle();</span></span></code></pre></div><h3 id="_5-å…¶å®ƒæ“ä½œ" tabindex="-1">5. å…¶å®ƒæ“ä½œ <a class="header-anchor" href="#_5-å…¶å®ƒæ“ä½œ" aria-label="Permalink to &quot;5. å…¶å®ƒæ“ä½œ&quot;">â€‹</a></h3><p>æˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨rxjsçš„å¼ºå¤§å¤„ç†èƒ½åŠ›ï¼Œå®ç°æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œå®˜æ–¹ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼Œå°±æ˜¯è¯·æ±‚å¤„ç†è¶…æ—¶æŠ›å‡ºé”™è¯¯çš„ä¾‹å­ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ä»£ç ï¼Œåªæˆªå–äº†ä¸€éƒ¨åˆ†ï¼Œpipeä¸­çš„æ“ä½œæ˜¯ï¼Œè¶…æ—¶5så°±æŠ›å‡ºå¼‚å¸¸å–æ¶ˆè¯¥æ¬¡è¯·æ±‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">return next.handle().pipe(</span></span>
<span class="line"><span style="color:#e1e4e8;">      timeout(5000),</span></span>
<span class="line"><span style="color:#e1e4e8;">      catchError(err =&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">        if (err instanceof TimeoutError) {</span></span>
<span class="line"><span style="color:#e1e4e8;">          return throwError(() =&gt; new RequestTimeoutException());</span></span>
<span class="line"><span style="color:#e1e4e8;">        }</span></span>
<span class="line"><span style="color:#e1e4e8;">        return throwError(() =&gt; err);</span></span>
<span class="line"><span style="color:#e1e4e8;">      }),</span></span>
<span class="line"><span style="color:#e1e4e8;">    );</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">return next.handle().pipe(</span></span>
<span class="line"><span style="color:#24292e;">      timeout(5000),</span></span>
<span class="line"><span style="color:#24292e;">      catchError(err =&gt; {</span></span>
<span class="line"><span style="color:#24292e;">        if (err instanceof TimeoutError) {</span></span>
<span class="line"><span style="color:#24292e;">          return throwError(() =&gt; new RequestTimeoutException());</span></span>
<span class="line"><span style="color:#24292e;">        }</span></span>
<span class="line"><span style="color:#24292e;">        return throwError(() =&gt; err);</span></span>
<span class="line"><span style="color:#24292e;">      }),</span></span>
<span class="line"><span style="color:#24292e;">    );</span></span></code></pre></div><h2 id="ä¹ã€custom-decorators" tabindex="-1">ä¹ã€Custom decorators <a class="header-anchor" href="#ä¹ã€custom-decorators" aria-label="Permalink to &quot;ä¹ã€Custom decorators&quot;">â€‹</a></h2><p>è£…é¥°å™¨è¿™ä¸ªæ¦‚å¿µå¯¹JavaScriptæ¥è¯´æ„Ÿè§‰æ˜¯ä¸€æ¬¡å°å°çš„é©æ–°ï¼Œéå¸¸å¥½ç”¨ï¼Œå…¶å®æ‰€è°“çš„è£…é¥°å™¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ@çš„å†™æ³•æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®ƒå¯ä»¥ä¿®é¥°ç±»ã€æ–¹æ³•ã€å±æ€§åŠå‚æ•°ï¼Œçœ‹ä¸€ä¸‹esæºç </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61f4971c974f40c49f7e9c82c664d1af~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>nestä¸ºæˆ‘ä»¬å†…ç½®äº†å¾ˆå¤šè£…é¥°å™¨ï¼Œå„ä¸ªå±‚é¢çš„éƒ½æœ‰ï¼Œæˆ‘ä»¬å®šä¹‰ç±»çš„æ—¶å€™ç”¨çš„æœ€å¤šçš„å°±æ˜¯@Injectableäº†å§ï¼Œå“ˆå“ˆï¼Œä¸‹é¢æˆ‘ä»¬æ¥è‡ªå®šä¹‰ä¸€äº›è£…é¥°å™¨ï¼Œéå¸¸å¥½ç”¨ï¼</p><h3 id="_1-å‚æ•°çº§åˆ«è£…é¥°å™¨" tabindex="-1">1. å‚æ•°çº§åˆ«è£…é¥°å™¨ <a class="header-anchor" href="#_1-å‚æ•°çº§åˆ«è£…é¥°å™¨" aria-label="Permalink to &quot;1. å‚æ•°çº§åˆ«è£…é¥°å™¨&quot;">â€‹</a></h3><p>æˆ‘ä»¬åœ¨ä¸€ä¸ªç³»ç»Ÿç™»å½•è®¤è¯åï¼Œtokené‡Œçš„userä¿¡æ¯éƒ½ä¼šè¢«é™„åŠ åˆ°requestä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªå‚æ•°è£…é¥°å™¨ç›´æ¥è·å–å½“å‰è¯·æ±‚æºå¸¦çš„userï¼Œå…·ä½“åšæ³•å¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { createParamDecorator, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Request } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export const UserDecorator = createParamDecorator(</span></span>
<span class="line"><span style="color:#e1e4e8;">  (data: unknown, ctx: ExecutionContext) =&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = ctx.switchToHttp().getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;">    return request.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">  },</span></span>
<span class="line"><span style="color:#e1e4e8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { createParamDecorator, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Request } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export const UserDecorator = createParamDecorator(</span></span>
<span class="line"><span style="color:#24292e;">  (data: unknown, ctx: ExecutionContext) =&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    const request = ctx.switchToHttp().getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#24292e;">    return request.user;</span></span>
<span class="line"><span style="color:#24292e;">  },</span></span>
<span class="line"><span style="color:#24292e;">);</span></span></code></pre></div><p>ä½¿ç”¨</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;userDec/test&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">  testUserDecorator(@UserDecorator() user) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(user);</span></span>
<span class="line"><span style="color:#e1e4e8;">    return `hello ${user.username}`;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;userDec/test&#39;)</span></span>
<span class="line"><span style="color:#24292e;">  testUserDecorator(@UserDecorator() user) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(user);</span></span>
<span class="line"><span style="color:#24292e;">    return `hello ${user.username}`;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span></code></pre></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b4d6ea782f340ca93a64ed019fc5548~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>å½“ç„¶è¿™ä¸ªçš„å‰ææ˜¯ä½ requestä¸­å¾—æœ‰userå•Šï¼Œè¿™å°±æ¶‰åŠåˆ°è®¤è¯ç›¸å…³çš„å†…å®¹äº†ï¼Œå¯ä»¥ç§»æ­¥æˆ‘çš„nestjsç³»åˆ—ç¬¬ä¸€ç¯‡æŸ¥çœ‹ï¼š<a href="https://juejin.cn/post/7171424088827625479" target="_blank" rel="noreferrer">https://juejin.cn/post/7171424088827625479</a></p><h3 id="_2-ç»™è£…é¥°å™¨ä¼ å‚" tabindex="-1">2. ç»™è£…é¥°å™¨ä¼ å‚ <a class="header-anchor" href="#_2-ç»™è£…é¥°å™¨ä¼ å‚" aria-label="Permalink to &quot;2. ç»™è£…é¥°å™¨ä¼ å‚&quot;">â€‹</a></h3><p>ç»™è£…é¥°å™¨ä¼ å‚ä¼šæ”¾åˆ°factoryæ–¹æ³•çš„dataåŸŸä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³ç»™ä¸Šé¢çš„Userè£…é¥°å™¨ä¼ ä¸€ä¸ªå±æ€§åusernameç›´æ¥è·å–ç”¨æˆ·çš„usernameï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export const UserDecorator = createParamDecorator(</span></span>
<span class="line"><span style="color:#e1e4e8;">  (data: string, ctx: ExecutionContext) =&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = ctx.switchToHttp().getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;">    const user = request.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">    return data ? user?.[data] : user;</span></span>
<span class="line"><span style="color:#e1e4e8;">  },</span></span>
<span class="line"><span style="color:#e1e4e8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export const UserDecorator = createParamDecorator(</span></span>
<span class="line"><span style="color:#24292e;">  (data: string, ctx: ExecutionContext) =&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    const request = ctx.switchToHttp().getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#24292e;">    const user = request.user;</span></span>
<span class="line"><span style="color:#24292e;">    return data ? user?.[data] : user;</span></span>
<span class="line"><span style="color:#24292e;">  },</span></span>
<span class="line"><span style="color:#24292e;">);</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;userDec/test&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">  testUserDecorator(@UserDecorator(&#39;username&#39;) user) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(user); // coderlj</span></span>
<span class="line"><span style="color:#e1e4e8;">    return `hello ${user}`; // hello coderlj</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;userDec/test&#39;)</span></span>
<span class="line"><span style="color:#24292e;">  testUserDecorator(@UserDecorator(&#39;username&#39;) user) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(user); // coderlj</span></span>
<span class="line"><span style="color:#24292e;">    return `hello ${user}`; // hello coderlj</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span></code></pre></div><h3 id="_3-ç»“åˆpipes" tabindex="-1">3. ç»“åˆpipes <a class="header-anchor" href="#_3-ç»“åˆpipes" aria-label="Permalink to &quot;3. ç»“åˆpipes&quot;">â€‹</a></h3><p>å¯ä»¥å¯¹è‡ªå®šä¹‰çš„è£…é¥°å™¨çš„å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œä¸‹é¢ä½¿ç”¨çš„æ˜¯æ¡†æ¶è‡ªå¸¦çš„ValidationPipe</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get()</span></span>
<span class="line"><span style="color:#e1e4e8;">async findOne(</span></span>
<span class="line"><span style="color:#e1e4e8;">  @User(new ValidationPipe({ validateCustomDecorators: true }))</span></span>
<span class="line"><span style="color:#e1e4e8;">  user: UserEntity,</span></span>
<span class="line"><span style="color:#e1e4e8;">) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(user);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get()</span></span>
<span class="line"><span style="color:#24292e;">async findOne(</span></span>
<span class="line"><span style="color:#24292e;">  @User(new ValidationPipe({ validateCustomDecorators: true }))</span></span>
<span class="line"><span style="color:#24292e;">  user: UserEntity,</span></span>
<span class="line"><span style="color:#24292e;">) {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(user);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h3 id="_4-è£…é¥°å™¨ç»„åˆå°è£…" tabindex="-1">4. è£…é¥°å™¨ç»„åˆå°è£… <a class="header-anchor" href="#_4-è£…é¥°å™¨ç»„åˆå°è£…" aria-label="Permalink to &quot;4. è£…é¥°å™¨ç»„åˆå°è£…&quot;">â€‹</a></h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªä¸œè¥¿åŠ çš„è£…é¥°å™¨å¾ˆå¤šï¼Œçœ‹ç€ä»£ç éå¸¸å¤æ‚ï¼Œå¯ä»¥è¿›è¡ŒæŠ½å–é‡æ„ï¼Œå°†ä¸€äº›ç»å¸¸ä½¿ç”¨ä½œç”¨å¯ä»¥èšåˆçš„æ”¾åœ¨ä¸€èµ·ï¼Œæœ€åå®ç°ç”¨ä¸€ä¸ªè£…é¥°å™¨å®ç°å¯¹å¥½å‡ ä¸ªè£…é¥°å™¨çš„å°è£…ï¼Œå¦‚ä¸‹ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { applyDecorators } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export function Auth(...roles: Role[]) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return applyDecorators(</span></span>
<span class="line"><span style="color:#e1e4e8;">    SetMetadata(&#39;roles&#39;, roles),</span></span>
<span class="line"><span style="color:#e1e4e8;">    UseGuards(AuthGuard, RolesGuard),</span></span>
<span class="line"><span style="color:#e1e4e8;">    ApiBearerAuth(),</span></span>
<span class="line"><span style="color:#e1e4e8;">    ApiUnauthorizedResponse({ description: &#39;Unauthorized&#39; }),</span></span>
<span class="line"><span style="color:#e1e4e8;">  );</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { applyDecorators } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export function Auth(...roles: Role[]) {</span></span>
<span class="line"><span style="color:#24292e;">  return applyDecorators(</span></span>
<span class="line"><span style="color:#24292e;">    SetMetadata(&#39;roles&#39;, roles),</span></span>
<span class="line"><span style="color:#24292e;">    UseGuards(AuthGuard, RolesGuard),</span></span>
<span class="line"><span style="color:#24292e;">    ApiBearerAuth(),</span></span>
<span class="line"><span style="color:#24292e;">    ApiUnauthorizedResponse({ description: &#39;Unauthorized&#39; }),</span></span>
<span class="line"><span style="color:#24292e;">  );</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦ç”¨ä¸€ä¸ªå°±è¡Œ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;users&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">@Auth(&#39;admin&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">findAllUsers() {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;users&#39;)</span></span>
<span class="line"><span style="color:#24292e;">@Auth(&#39;admin&#39;)</span></span>
<span class="line"><span style="color:#24292e;">findAllUsers() {}</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-2cdec040 data-v-c47f21a7><!--[--><!--]--><!----><nav class="prev-next" data-v-c47f21a7><div class="pager" data-v-c47f21a7><a class="pager-link prev" href="/blog/backend/nestjs/NestJS%E5%9F%BA%E7%A1%80/3.ExecutionContext.html" data-v-c47f21a7><span class="desc" data-v-c47f21a7>Previous page</span><span class="title" data-v-c47f21a7>3.ExecutionContext</span></a></div><div class="pager" data-v-c47f21a7><a class="pager-link next" href="/blog/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/1.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5.html" data-v-c47f21a7><span class="desc" data-v-c47f21a7>Next page</span><span class="title" data-v-c47f21a7>1.ä¾èµ–æ³¨å…¥</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"backend_nestjs_nestjsåŸºç¡€_2.æ ¸å¿ƒæ¦‚å¿µå°ç»“.md\":\"823ecc50\",\"backend_gitlearn_å¸¸ç”¨å‘½ä»¤_4.reset.md\":\"0a571ce0\",\"backend_gitlearn_è¿œç¨‹ä»“åº“_1.github.md\":\"2463411f\",\"backend_gitlearn_index.md\":\"add6fc06\",\"backend_gitlearn_å¸¸ç”¨å‘½ä»¤_2.å·¥ä½œåŒºå’Œæš‚å­˜åŒº.md\":\"de09da48\",\"backend_gitlearn_åŸºæœ¬é…ç½®_1.åˆè¯†é…ç½®.md\":\"f8539a03\",\"backend_gitlearn_å¸¸ç”¨å‘½ä»¤_3.åˆ†æ”¯ç®¡ç†.md\":\"e2768843\",\"backend_gitlearn_è¿œç¨‹ä»“åº“_3.push.md\":\"edfe096f\",\"backend_nestjs_nestjsåŸºç¡€_3.executioncontext.md\":\"35056e53\",\"backend_gitlearn_å¸¸ç”¨å‘½ä»¤_6.tagæ‰“æ ‡ç­¾.md\":\"a3fc29b3\",\"backend_gitlearn_è¿œç¨‹ä»“åº“_2.pullæ‹‰å–æ›´æ–°.md\":\"a35b2a86\",\"backend_gitlearn_å¸¸ç”¨å‘½ä»¤_5.stashingä¸´æ—¶å­˜å‚¨å·¥ä½œ.md\":\"c2523c6e\",\"backend_gitlearn_å¸¸ç”¨å‘½ä»¤_1.å¸¸ç”¨å‘½ä»¤.md\":\"b2e79cad\",\"backend_nestjs_nestjsåŸºç¡€_4.ä¹å¤§æ ¸å¿ƒæ¦‚å¿µ.md\":\"b033e4c6\",\"backend_gitlearn_åŸºæœ¬é…ç½®_2.é…ç½®åˆ«å.md\":\"a1e4ed69\",\"backend_nestjs_nestjsè¿›é˜¶_1.ä¾èµ–æ³¨å…¥.md\":\"544d345a\",\"backend_nestjs_nestjsåŸºç¡€_1.nestjsé¡¹ç›®å¼€å‘ã€ç¼–ç¨‹æ€æƒ³ã€‘.md\":\"f3bd00b6\",\"backend_nestjs_nestjsè¿›é˜¶_2.ç”Ÿå‘½å‘¨æœŸ.md\":\"30e0d689\",\"backend_nestjs_nestjsè¿›é˜¶_3.æ‰“åŒ…éƒ¨ç½²(âš‘).md\":\"a4ff6021\",\"backend_nestjs_nestjsè¿›é˜¶_4.æ•´åˆprisma(todo).md\":\"14f26c81\",\"backend_nestjs_nestjsè¿›é˜¶_5.é«˜çº§é…ç½®(todo).md\":\"e86f68c4\",\"backend_nestjs_nestjsè¿›é˜¶_6.ç¼“å­˜(todo).md\":\"ac4d017b\",\"backend_nestjs_index.md\":\"0cc973b6\",\"backend_nestjs_å®‰å…¨è®¤è¯_1.ç™»å½•è®¤è¯(jwt).md\":\"9353c18b\",\"backend_nginx_index.md\":\"51af2231\",\"backend_nginx_å…¶å®ƒ_1.æ—¥å¿—.md\":\"8a80edbc\",\"backend_nginx_å…¶å®ƒ_2.æ–‡ä»¶å…³è”ç¨‹åº.md\":\"69d574e4\",\"backend_nginx_å…¶å®ƒ_3.httpçŠ¶æ€ç .md\":\"132de733\",\"index.md\":\"35167b2e\",\"backend_nginx_åŸºç¡€çŸ¥è¯†_1.è¿æ¥çŠ¶æ€æ¨¡å—.md\":\"da14b41d\",\"backend_nginx_åŸºç¡€çŸ¥è¯†_2.éšæœºä¸»é¡µæ¨¡å—.md\":\"ff0ce865\",\"backend_nginx_åŸºç¡€çŸ¥è¯†_3.æ›¿æ¢æ¨¡å—.md\":\"d416ed02\",\"backend_nginx_åŸºç¡€çŸ¥è¯†_4.æ–‡ä»¶è¯»å–æ¨¡å—.md\":\"9a8f147c\",\"backend_nginx_åŸºç¡€çŸ¥è¯†_5.æ–‡ä»¶å‹ç¼©æ¨¡å—.md\":\"ea8e24b2\",\"backend_nginx_åŸºç¡€çŸ¥è¯†_6.é¡µé¢ç¼“å­˜æ¨¡å—.md\":\"40ba04ac\",\"backend_nginx_é…ç½®ç›¸å…³_1.é»˜è®¤é…ç½®.md\":\"c12a5381\",\"backend_nginx_é…ç½®ç›¸å…³_2.ä¸»é…ç½®æ–‡ä»¶.md\":\"710f0a67\",\"backend_nginx_é…ç½®ç›¸å…³_3.å­é…ç½®ç›®å½•.md\":\"58440e7e\",\"backend_nginx_é…ç½®ç›¸å…³_4.location.md\":\"94862ca6\",\"backend_nginx_é…ç½®ç›¸å…³_5.ä»£ç†.md\":\"22d3ee0d\",\"backend_nginx_é…ç½®ç›¸å…³_6.proxyä»£ç†.md\":\"c24e964b\",\"frontend_css_index.md\":\"f31eb3bc\",\"frontend_html_index.md\":\"faa0e581\",\"frontend_javascript_index.md\":\"b02c3c83\",\"frontend_typescript_index.md\":\"eaf6aa4a\",\"frontend_ui_index.md\":\"61922c0b\",\"frontend_vue_index.md\":\"5482f470\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"kkzzyytçš„ä¸ªäººè®°å½•\",\"description\":\"Talk is cheap, show me your code.\",\"base\":\"/blog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"ğŸ“ code\",\"logo\":\"/img/logo.png\",\"nav\":[{\"text\":\"é¦–é¡µ\",\"link\":\"/index\"},{\"text\":\"å‰ç«¯å°é£Ÿå ‚\",\"activeMatch\":\"frontend\",\"items\":[{\"text\":\"åŸºæœ¬åŠŸ\",\"items\":[{\"text\":\"Html\",\"link\":\"/frontend/html/\"},{\"text\":\"CSS\",\"link\":\"/frontend/css/\"},{\"text\":\"JavaScript\",\"link\":\"/frontend/javascript/\"},{\"text\":\"TypeScript\",\"link\":\"/frontend/typescript/\"}]},{\"text\":\"æ¡†æ¶\",\"items\":[{\"text\":\"React\",\"link\":\"/frontend/react/\"},{\"text\":\"Vue\",\"link\":\"/frontend/vue/\"}]},{\"text\":\"ä¸°å¯Œèµ„æº\",\"items\":[{\"text\":\"ç»„ä»¶åº“\",\"link\":\"/frontend/ui/\"}]}]},{\"text\":\"åç«¯è‡ªä¹ å®¤\",\"activeMatch\":\"/backend/\",\"items\":[{\"text\":\"æ¡†æ¶\",\"items\":[{\"text\":\"NestJS\",\"link\":\"/backend/nestjs/\"}]},{\"text\":\"æœåŠ¡\",\"items\":[{\"text\":\"Nginx\",\"link\":\"/backend/nginx/\"},{\"text\":\"Git\",\"link\":\"/backend/gitLearn/\"}]}]}],\"sidebar\":{\"/backend/nestjs/\":[{\"text\":\"NestJSåŸºç¡€\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.Nestjsé¡¹ç›®å¼€å‘ã€ç¼–ç¨‹æ€æƒ³ã€‘\",\"link\":\"/backend/nestjs/NestJSåŸºç¡€/1.Nestjsé¡¹ç›®å¼€å‘ã€ç¼–ç¨‹æ€æƒ³ã€‘\"},{\"text\":\"2.æ ¸å¿ƒæ¦‚å¿µå°ç»“\",\"link\":\"/backend/nestjs/NestJSåŸºç¡€/2.æ ¸å¿ƒæ¦‚å¿µå°ç»“\"},{\"text\":\"3.ExecutionContext\",\"link\":\"/backend/nestjs/NestJSåŸºç¡€/3.ExecutionContext\"},{\"text\":\"4.ä¹å¤§æ ¸å¿ƒæ¦‚å¿µ\",\"link\":\"/backend/nestjs/NestJSåŸºç¡€/4.ä¹å¤§æ ¸å¿ƒæ¦‚å¿µ\"}]},{\"text\":\"NestJSè¿›é˜¶\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.ä¾èµ–æ³¨å…¥\",\"link\":\"/backend/nestjs/NestJSè¿›é˜¶/1.ä¾èµ–æ³¨å…¥\"},{\"text\":\"2.ç”Ÿå‘½å‘¨æœŸ\",\"link\":\"/backend/nestjs/NestJSè¿›é˜¶/2.ç”Ÿå‘½å‘¨æœŸ\"},{\"text\":\"3.æ‰“åŒ…éƒ¨ç½²(âš‘)\",\"link\":\"/backend/nestjs/NestJSè¿›é˜¶/3.æ‰“åŒ…éƒ¨ç½²(âš‘)\"},{\"text\":\"4.æ•´åˆprisma(todo)\",\"link\":\"/backend/nestjs/NestJSè¿›é˜¶/4.æ•´åˆprisma(todo)\"},{\"text\":\"5.é«˜çº§é…ç½®(todo)\",\"link\":\"/backend/nestjs/NestJSè¿›é˜¶/5.é«˜çº§é…ç½®(todo)\"},{\"text\":\"6.ç¼“å­˜(todo)\",\"link\":\"/backend/nestjs/NestJSè¿›é˜¶/6.ç¼“å­˜(todo)\"}]},{\"text\":\"å®‰å…¨è®¤è¯\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.ç™»å½•è®¤è¯(JWT)\",\"link\":\"/backend/nestjs/å®‰å…¨è®¤è¯/1.ç™»å½•è®¤è¯(JWT)\"}]}],\"/backend/nginx/\":[{\"text\":\"åŸºç¡€çŸ¥è¯†\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.è¿æ¥çŠ¶æ€æ¨¡å—\",\"link\":\"/backend/nginx/åŸºç¡€çŸ¥è¯†/1.è¿æ¥çŠ¶æ€æ¨¡å—\"},{\"text\":\"2.éšæœºä¸»é¡µæ¨¡å—\",\"link\":\"/backend/nginx/åŸºç¡€çŸ¥è¯†/2.éšæœºä¸»é¡µæ¨¡å—\"},{\"text\":\"3.æ›¿æ¢æ¨¡å—\",\"link\":\"/backend/nginx/åŸºç¡€çŸ¥è¯†/3.æ›¿æ¢æ¨¡å—\"},{\"text\":\"4.æ–‡ä»¶è¯»å–æ¨¡å—\",\"link\":\"/backend/nginx/åŸºç¡€çŸ¥è¯†/4.æ–‡ä»¶è¯»å–æ¨¡å—\"},{\"text\":\"5.æ–‡ä»¶å‹ç¼©æ¨¡å—\",\"link\":\"/backend/nginx/åŸºç¡€çŸ¥è¯†/5.æ–‡ä»¶å‹ç¼©æ¨¡å—\"},{\"text\":\"6.é¡µé¢ç¼“å­˜æ¨¡å—\",\"link\":\"/backend/nginx/åŸºç¡€çŸ¥è¯†/6.é¡µé¢ç¼“å­˜æ¨¡å—\"}]},{\"text\":\"é…ç½®ç›¸å…³\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.é»˜è®¤é…ç½®\",\"link\":\"/backend/nginx/é…ç½®ç›¸å…³/1.é»˜è®¤é…ç½®\"},{\"text\":\"2.ä¸»é…ç½®æ–‡ä»¶\",\"link\":\"/backend/nginx/é…ç½®ç›¸å…³/2.ä¸»é…ç½®æ–‡ä»¶\"},{\"text\":\"3.å­é…ç½®ç›®å½•\",\"link\":\"/backend/nginx/é…ç½®ç›¸å…³/3.å­é…ç½®ç›®å½•\"},{\"text\":\"4.location\",\"link\":\"/backend/nginx/é…ç½®ç›¸å…³/4.location\"},{\"text\":\"5.ä»£ç†\",\"link\":\"/backend/nginx/é…ç½®ç›¸å…³/5.ä»£ç†\"},{\"text\":\"6.proxyä»£ç†\",\"link\":\"/backend/nginx/é…ç½®ç›¸å…³/6.proxyä»£ç†\"}]},{\"text\":\"å…¶å®ƒ\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.æ—¥å¿—\",\"link\":\"/backend/nginx/å…¶å®ƒ/1.æ—¥å¿—\"},{\"text\":\"2.æ–‡ä»¶å…³è”ç¨‹åº\",\"link\":\"/backend/nginx/å…¶å®ƒ/2.æ–‡ä»¶å…³è”ç¨‹åº\"},{\"text\":\"3.HTTPçŠ¶æ€ç \",\"link\":\"/backend/nginx/å…¶å®ƒ/3.HTTPçŠ¶æ€ç \"}]}],\"/backend/gitLearn/\":[{\"text\":\"åŸºæœ¬é…ç½®\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.åˆè¯†é…ç½®\",\"link\":\"/backend/gitLearn/åŸºæœ¬é…ç½®/1.åˆè¯†é…ç½®\"},{\"text\":\"2.é…ç½®åˆ«å\",\"link\":\"/backend/gitLearn/åŸºæœ¬é…ç½®/2.é…ç½®åˆ«å\"}]},{\"text\":\"å¸¸ç”¨å‘½ä»¤\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.å¸¸ç”¨å‘½ä»¤\",\"link\":\"/backend/gitLearn/å¸¸ç”¨å‘½ä»¤/1.å¸¸ç”¨å‘½ä»¤\"},{\"text\":\"2.å·¥ä½œåŒºå’Œæš‚å­˜åŒº\",\"link\":\"/backend/gitLearn/å¸¸ç”¨å‘½ä»¤/2.å·¥ä½œåŒºå’Œæš‚å­˜åŒº\"},{\"text\":\"3.åˆ†æ”¯ç®¡ç†\",\"link\":\"/backend/gitLearn/å¸¸ç”¨å‘½ä»¤/3.åˆ†æ”¯ç®¡ç†\"},{\"text\":\"4.reset\",\"link\":\"/backend/gitLearn/å¸¸ç”¨å‘½ä»¤/4.reset\"},{\"text\":\"5.stashingä¸´æ—¶å­˜å‚¨å·¥ä½œ\",\"link\":\"/backend/gitLearn/å¸¸ç”¨å‘½ä»¤/5.stashingä¸´æ—¶å­˜å‚¨å·¥ä½œ\"},{\"text\":\"6.Tagæ‰“æ ‡ç­¾\",\"link\":\"/backend/gitLearn/å¸¸ç”¨å‘½ä»¤/6.Tagæ‰“æ ‡ç­¾\"}]},{\"text\":\"è¿œç¨‹ä»“åº“\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.github\",\"link\":\"/backend/gitLearn/è¿œç¨‹ä»“åº“/1.github\"},{\"text\":\"2.pullæ‹‰å–æ›´æ–°\",\"link\":\"/backend/gitLearn/è¿œç¨‹ä»“åº“/2.pullæ‹‰å–æ›´æ–°\"},{\"text\":\"3.push\",\"link\":\"/backend/gitLearn/è¿œç¨‹ä»“åº“/3.push\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/zhu325\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>